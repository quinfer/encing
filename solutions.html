<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Barry Quinn">

<title>Advanced Financial Data Analytics – Appendix B — Chapter solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./academic-integrity.html" rel="next">
<link href="./resources.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./resources.html">Appendices</a></li><li class="breadcrumb-item"><a href="./solutions.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Chapter solutions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Financial Data Analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Core Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./primer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistics and Probability Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Toolkit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Understanding Financial Data and Asset Returns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Financial times series econometrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayesian_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Machine Learning in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Advanced Material</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multilevel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Multilevel Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Causal inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colliderbias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Causal Salad, Endogeneity and collider bias</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solutions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Chapter solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./academic-integrity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Advanced Financial Data Analytics Academic Integrity Policy</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-1-statistics-and-probability-primer" id="toc-chapter-1-statistics-and-probability-primer" class="nav-link active" data-scroll-target="#chapter-1-statistics-and-probability-primer"><span class="header-section-number">B.1</span> Chapter 1: Statistics and Probability Primer</a></li>
  <li><a href="#chapter-2-toolkit" id="toc-chapter-2-toolkit" class="nav-link" data-scroll-target="#chapter-2-toolkit"><span class="header-section-number">B.2</span> Chapter 2: Toolkit</a></li>
  <li><a href="#chapter-4-time-series-models" id="toc-chapter-4-time-series-models" class="nav-link" data-scroll-target="#chapter-4-time-series-models"><span class="header-section-number">B.3</span> Chapter 4: Time series models</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./resources.html">Appendices</a></li><li class="breadcrumb-item"><a href="./solutions.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Chapter solutions</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Appendix B — Chapter solutions</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Barry Quinn </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="chapter-1-statistics-and-probability-primer" class="level2" data-number="B.1">
<h2 data-number="B.1" class="anchored" data-anchor-id="chapter-1-statistics-and-probability-primer"><span class="header-section-number">B.1</span> Chapter 1: Statistics and Probability Primer</h2>
<ol type="1">
<li><p>Calculating Stock Returns: <strong>Objective:</strong> To calculate the annualized return of a stock over a three-year period. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial and final prices of the stock</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>initial_price <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>final_price <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Investment period in years</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the annualized return</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>annualized_return <span class="ot">&lt;-</span> (final_price <span class="sc">/</span> initial_price)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>years) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the annualized return</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(annualized_return)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1447142</code></pre>
</div>
</div>
<p><strong>Explanation:</strong> The annualized return is calculated by finding the geometric average of the yearly return. It accounts for compounding over the period.</p></li>
<li><p>Descriptive Statistics of Financial Data: <strong>Objective:</strong> To summarize and interpret a dataset of stock prices. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset of stock prices</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>stock_prices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">120</span>, <span class="dv">125</span>, <span class="dv">130</span>, <span class="dv">128</span>, <span class="dv">135</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">summary</span>(stock_prices)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the summary statistics</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  120.0   125.0   128.0   127.6   130.0   135.0 </code></pre>
</div>
</div>
<p><strong>Explanation:</strong> <code>summary()</code> function in R provides a quick statistical summary of the data, including measures like minimum, first quartile, median, mean, third quartile, and maximum.</p></li>
<li><p>Basic Risk Assessment: <strong>Objective:</strong> To calculate and interpret the standard deviation of stock returns as a measure of risk. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns of a stock</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>stock_returns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.02</span>, <span class="sc">-</span><span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.01</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating standard deviation</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>risk_measure <span class="ot">&lt;-</span> <span class="fu">sd</span>(stock_returns)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the standard deviation</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(risk_measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03114482</code></pre>
</div>
</div>
<p><strong>Explanation:</strong> The standard deviation provides a measure of the dispersion of returns. A higher standard deviation implies greater risk (volatility) in the stock’s returns.</p></li>
<li><p>Simple Probability Calculation: <strong>Objective:</strong> To calculate the probability of an event in a financial context, exemplified by a coin toss. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of getting heads in a fair coin toss</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>probability_heads <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the probability</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(probability_heads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5</code></pre>
</div>
</div>
<p><strong>Explanation:</strong> This is a basic example of classical probability, where each outcome (heads or tails) is equally likely.</p></li>
<li><p>Basic Time Series Forecasting: <strong>Objective:</strong> To use a simple moving average for forecasting the next data point in a financial time series. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Historical stock prices</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>stock_prices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">120</span>, <span class="dv">122</span>, <span class="dv">121</span>, <span class="dv">123</span>, <span class="dv">125</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast using a simple moving average of the last 3 prices</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>forecast_price <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">tail</span>(stock_prices, <span class="at">n=</span><span class="dv">3</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the forecasted price</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(forecast_price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123</code></pre>
</div>
</div>
<p><strong>Explanation:</strong> This method forecasts the next data point by calculating the average of a specified number of the most recent data points (here, the last three prices).</p></li>
<li><p>Advanced Risk Modeling (VaR): <strong>Objective:</strong> To calculate and interpret the Value at Risk (VaR) for a portfolio. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Historical returns of a portfolio</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>portfolio_returns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.03</span>, <span class="sc">-</span><span class="fl">0.02</span>, <span class="fl">0.04</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence level (e.g., 95%)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating VaR</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>VaR <span class="ot">&lt;-</span> <span class="fu">quantile</span>(portfolio_returns, alpha)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the VaR</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(VaR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    5% 
-0.044 </code></pre>
</div>
</div>
<p><strong>Explanation:</strong> VaR measures the maximum expected loss over a given period under normal market conditions at a specified confidence level (here, 95%).</p></li>
<li><p>Bayesian Update in Stock Forecasting: <strong>Objective:</strong> To perform a Bayesian update for a stock price prediction. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uniform prior distribution</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial likelihood based on new evidence (e.g., 6 increases in 10 periods)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>likelihood <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(<span class="dv">6</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">prob=</span><span class="fl">0.5</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the posterior distribution</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> prior <span class="sc">*</span> likelihood</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the posterior probability</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4101562</code></pre>
</div>
</div>
<p><strong>Explanation:</strong> Bayesian update combines prior belief (uniform distribution in this case) with new evidence (likelihood) to revise the belief about a stock’s price movement.</p></li>
<li><p>Hypothesis Testing in Financial Returns: <strong>Objective:</strong> To conduct and interpret a hypothesis test comparing a new investment strategy to market returns. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns from a new investment strategy</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>strategy_returns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.07</span>, <span class="fl">0.08</span>, <span class="fl">0.09</span>, <span class="fl">0.06</span>, <span class="fl">0.1</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Market average returns for comparison</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>market_returns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing a t-test</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>t_test_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(strategy_returns, market_returns)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the t-test results</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_test_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  strategy_returns and market_returns
t = 4.2426, df = 4, p-value = 0.01324
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 0.01036757 0.04963243
sample estimates:
mean of x mean of y 
     0.08      0.05 </code></pre>
</div>
</div>
<p><strong>Explanation:</strong> The t-test assesses whether the mean returns of the new strategy are significantly different from the market average. The p-value indicates the probability of observing such a difference if there were no real difference.</p></li>
<li><p>Complex Time Series Analysis: <strong>Objective:</strong> To fit an ARIMA model to a financial time series and forecast future values. <strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming stock_prices is a time series object</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load the forecast package</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting an ARIMA model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(stock_prices)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting the next value</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>forecast_result <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_model, <span class="at">h=</span><span class="dv">1</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the forecast</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(forecast_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
6          122.2 119.7349 124.6651 118.4299 125.9701</code></pre>
</div>
</div>
<p><strong>Explanation:</strong> <code>auto.arima()</code> function automatically selects the best ARIMA model for the time series data. The <code>forecast()</code> function then uses this model to predict future values (here, the forecast horizon is 1).</p></li>
<li><p>Portfolio Optimization: The Markowitz model involves optimizing a portfolio by finding the best combination of assets that minimizes risk (variance) for a given expected return, or maximizes return for a given level of risk. This is achieved by adjusting the weights of each asset in the portfolio.</p></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the quadprog library for quadratic programming</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quadprog)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a sequence of 10 dates, one day apart</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2023-01-01"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> start_date, <span class="at">by =</span> <span class="st">"day"</span>, <span class="at">length.out =</span> N)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the historical returns for four assets</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>historical_returns <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Asset1"</span><span class="ot">=</span><span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="fl">0.04</span>),                                  </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Asset2"</span><span class="ot">=</span><span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="fl">0.03</span>),                                 </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Asset3"</span><span class="ot">=</span><span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="fl">0.09</span>),                                 </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Asset4"</span><span class="ot">=</span><span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="fl">0.01</span>))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(historical_returns) <span class="ot">&lt;-</span> dates</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the covariance matrix of returns</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>Dmat <span class="ot">&lt;-</span> <span class="fu">cov</span>(historical_returns)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define dvec as zero for minimum variance portfolio</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>dvec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(historical_returns))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the constraints (sum of weights = 1)</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Amat needs to have as many rows as there are assets plus one for the sum constraint</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>Amat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="fu">diag</span>(<span class="fu">ncol</span>(historical_returns)))</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>bvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(historical_returns)))</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify and solve the optimization problem</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>sol <span class="ot">&lt;-</span> <span class="fu">solve.QP</span>(Dmat, dvec, Amat, bvec, <span class="at">meq =</span> <span class="dv">1</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the optimal weights</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>optimal_weights <span class="ot">&lt;-</span> sol<span class="sc">$</span>solution</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the optimal weights</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.49888249 0.05909223 0.27920936 0.16281591</code></pre>
</div>
</div>
<p><strong>Interpretation</strong></p>
<ol type="1">
<li><strong>Setting Up the Data</strong>:
<ul>
<li>The code first sets up a simulated historical return data for four assets over ten days. This is necessary as the Markowitz model requires historical return data to calculate asset weights.</li>
</ul></li>
<li><strong>Covariance Matrix</strong>:
<ul>
<li><code>Dmat</code> is calculated as the covariance matrix of the asset returns. It represents the risk relationships between each pair of assets, crucial in determining how asset prices move relative to each other.</li>
</ul></li>
<li><strong>Defining Optimization Parameters</strong>:
<ul>
<li>The vector <code>dvec</code> is set to zero since the goal is to minimize variance without targeting a specific return.<br>
</li>
<li><code>Amat</code> combines an equality constraint (that the sum of the asset weights equals 1) with non-negativity constraints (each asset weight must be zero or positive).</li>
</ul></li>
<li><strong>Quadratic Programming Problem</strong>:
<ul>
<li>The <code>solve.QP</code> function is used to solve the quadratic programming problem. It aims to find the asset weights that minimize the overall portfolio variance subject to the given constraints.</li>
</ul></li>
<li><strong>Optimal Weights</strong>:
<ul>
<li>The solution <code>sol$solution</code> provides the optimal weights for each asset. These weights represent how much of the portfolio should be allocated to each asset to achieve minimum risk.</li>
</ul></li>
<li><strong>Result</strong>:
<ul>
<li>The output is a set of portfolio weights that minimize the portfolio’s variance (risk), considering the historical return covariance of the assets and the constraints (total weight equals 1, non-negative weights). This represents the most risk-efficient allocation of assets in the portfolio under the given conditions.</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>These solutions provide a mix of conceptual explanations and practical R code, offering a comprehensive understanding of each question’s objective and methodology.</p>
</div>
</div>
</section>
<section id="chapter-2-toolkit" class="level2" data-number="B.2">
<h2 data-number="B.2" class="anchored" data-anchor-id="chapter-2-toolkit"><span class="header-section-number">B.2</span> Chapter 2: Toolkit</h2>
<p><strong>Theoretical Questions Solutions:</strong> <em>Easier:</em></p>
<ol type="1">
<li><strong>R’s Role in Financial Analysis:</strong>
<ul>
<li>Solution: R offers extensive packages for statistical analysis and data handling, making it ideal for analyzing complex financial data. Its powerful graphical capabilities enable clear visualization of financial trends and patterns.</li>
</ul></li>
<li><strong>Advantages of Cloud Computing in Finance:</strong>
<ul>
<li>Solution: Cloud platforms like Posit Cloud provide scalability, easy access to advanced analytics tools, and collaborative features, essential for handling large datasets and complex financial models.</li>
</ul></li>
<li><strong>Data Visualization Importance:</strong>
<ul>
<li>Solution: Data visualization is key in financial analysis for interpreting complex data sets and communicating findings effectively. <code>ggplot2</code> offers a versatile, layer-based plotting system, making complex visualizations more intuitive.</li>
</ul></li>
<li><strong>Version Control with Git:</strong>
<ul>
<li>Solution: Version control is crucial for managing changes in code, especially in collaborative projects. Git allows tracking of changes, reverting to previous versions, and effective team collaboration.</li>
</ul></li>
<li><strong>Growth Mindset in Data Science:</strong>
<ul>
<li>Solution: A growth mindset encourages continual learning and adaptability, crucial in a field like financial data analytics, where technologies and market conditions are constantly evolving.</li>
</ul></li>
</ol>
<p><em>Advanced:</em></p>
<ol start="6" type="1">
<li><strong>Statistical vs.&nbsp;Machine Learning Approaches:</strong>
<ul>
<li>Solution: Statistical modeling typically involves hypothesis-driven models, while machine learning focuses on prediction using data-driven models. Both approaches are valuable in financial data analysis, each with strengths in different scenarios.</li>
</ul></li>
<li><strong>Reproducibility Challenges:</strong>
<ul>
<li>Solution: Challenges include data accessibility, software environment consistency, and clear documentation. Solutions involve using version control, containerization tools, and comprehensive documentation of analysis steps.</li>
</ul></li>
<li><strong>Collaborative Coding with Git and GitHub:</strong>
<ul>
<li>Solution: Git and GitHub facilitate version control, issue tracking, and code review, supporting a collaborative workflow. This ensures code integrity and effective team collaboration in financial analysis projects.</li>
</ul></li>
<li><strong>Tidyverse Ecosystem:</strong>
<ul>
<li>Solution: The Tidyverse provides a consistent and user-friendly syntax for data import, cleaning, manipulation, and visualization, streamlining the data analysis process and enhancing productivity in financial data analytics.</li>
</ul></li>
<li><strong>Modular Coding for Financial Analysis:</strong>
<ul>
<li>Solution: Modular coding in R improves code readability, reusability, and testing. In financial analysis, where models can be complex, this approach enables easier maintenance and collaboration.</li>
</ul></li>
</ol>
<p><strong>Practical Questions Solutions:</strong> <em>Easier:</em></p>
<ol type="1">
<li><p><strong>Basic R Data Manipulation:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">percent_change =</span> (stock_price <span class="sc">-</span> <span class="fu">lag</span>(stock_price)) <span class="sc">/</span> <span class="fu">lag</span>(stock_price) <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interpretation: Percentage change helps identify trends in stock prices, indicating potential growth or decline.</p></li>
<li><p><strong>Creating Plots in R:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> stock_price)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>`Interpretation: Line charts provide a clear view of stock price trends over time, aiding in investment decisions.</p></li>
<li><p><strong>Git Basics:</strong> Commands: <code>git init</code>, <code>git add .</code>, <code>git commit -m "Initial commit"</code> Benefits: Ensures code versioning, allows tracking of changes, and facilitates team collaboration.</p></li>
<li><p><strong>Data Cleaning in R:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">stock_price =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(stock_price), <span class="fu">mean</span>(stock_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), stock_price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Implications: Handling missing data prevents biases and errors in financial analysis.</p></li>
<li><p><strong>Basic Linear Regression in R:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(stock_price <span class="sc">~</span> stock_id, <span class="at">data =</span> data)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interpretation: The model provides insights into how stock prices are related to their IDs, which could correlate with other financial factors.</p></li>
</ol>
<p><em>Advanced:</em></p>
<ol start="6" type="1">
<li><p><strong>Advanced Financial Modeling:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(stock_data<span class="sc">$</span>stock_price)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assumptions: Assumes stock prices follow an ARIMA process. Limitations include potential overfitting and sensitivity to data anomalies.</p></li>
<li><p><strong>Machine Learning Application:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(stock_price <span class="sc">~</span> ., <span class="at">data =</span> stock_data, <span class="at">method =</span> <span class="st">"rf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Choice and Effectiveness: Random Forest is chosen for its ability to handle non-linear relationships in data, useful in complex financial markets.</p></li>
<li><p><strong>Reproducible Analysis with Quarto:</strong> Use Quarto to create a document that combines R code for financial analysis, outputs, and narrative. Importance: Ensures that financial analyses can be reliably reproduced and verified.</p></li>
<li><p><strong>Tidyverse for Complex Data Manipulation:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>stock_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stock_id) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">average_price =</span> <span class="fu">mean</span>(stock_price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Benefit: This manipulation provides insights into the average performance of each stock, crucial for portfolio analysis.</p></li>
<li><p><strong>Collaborative Financial Project using GitHub:</strong> Workflow: Clone a repository, create branches for features, use pull requests for merging. Benefits: Enhances collaboration, ensures code review, and maintains project organization.</p></li>
</ol>
<p>These solutions offer a comprehensive understanding of both the theoretical concepts and practical applications in financial data analytics using R and related tools.</p>
</section>
<section id="chapter-4-time-series-models" class="level2" data-number="B.3">
<h2 data-number="B.3" class="anchored" data-anchor-id="chapter-4-time-series-models"><span class="header-section-number">B.3</span> Chapter 4: Time series models</h2>
<p>Here are the R coded solutions with detailed explanations for each exercise:</p>
<p>Exercise 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lubridate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: PerformanceAnalytics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: xts</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'PerformanceAnalytics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    legend</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: quantmod</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: TTR</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download historical stock prices for Apple Inc. (AAPL)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>aapl_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"AAPL"</span>, <span class="at">from =</span> <span class="st">"2018-01-01"</span>, <span class="at">to =</span> <span class="st">"2023-12-31"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the closing prices and calculate daily returns</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>closing_prices <span class="ot">&lt;-</span> aapl_data<span class="sc">$</span>close</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>daily_returns <span class="ot">&lt;-</span> (closing_prices <span class="sc">-</span> <span class="fu">lag</span>(closing_prices)) <span class="sc">/</span> <span class="fu">lag</span>(closing_prices)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the closing prices over time</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(closing_prices, <span class="at">main =</span> <span class="st">"Apple Inc. (AAPL) Closing Prices"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Price"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the daily returns over time     </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(daily_returns, <span class="at">main =</span> <span class="st">"Apple Inc. (AAPL) Daily Returns"</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Return"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Explanation: - The <code>tidyquant</code> package is used to download historical stock price data from Yahoo Finance. Certainly! Here’s the complete explanation for Exercise 1:</p>
<p>Explanation: - The <code>tidyquant</code> package is used to download historical stock price data from Yahoo Finance. - <code>tq_get()</code> retrieves the data for the specified ticker symbol (AAPL) and date range. - The closing prices are extracted from the downloaded data using <code>aapl_data$close</code>. - Daily returns are calculated based on the closing prices using the formula <code>(closing_prices - lag(closing_prices)) / lag(closing_prices)</code>. - The closing prices and daily returns are plotted using the <code>plot()</code> function. - The plots help identify trends, seasonality, or unusual patterns in the price and return series.</p>
<p>Exercise 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(signal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'signal'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, poly</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply smoothing techniques</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>sma_20 <span class="ot">&lt;-</span> <span class="fu">SMA</span>(closing_prices, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ema_0<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">EMA</span>(closing_prices, <span class="at">n =</span> <span class="dv">20</span>, <span class="at">wilder =</span> <span class="cn">FALSE</span>, <span class="at">ratio =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in EMA(closing_prices, n = 20, wilder = FALSE, ratio = 0.1): both 'n'
and 'ratio' are specified; using 'n'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sg_filtered <span class="ot">&lt;-</span> <span class="fu">sgolayfilt</span>(closing_prices, <span class="at">p =</span> <span class="dv">3</span>, <span class="at">n =</span> <span class="dv">21</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>lowess_smoothed <span class="ot">&lt;-</span> <span class="fu">lowess</span>(closing_prices)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the original price series and smoothed series</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(closing_prices, <span class="at">main =</span> <span class="st">"Apple Inc. (AAPL) Closing Prices with Smoothing"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Price"</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sma_20, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ema_0<span class="fl">.1</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sg_filtered, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(lowess_smoothed<span class="sc">$</span>y, <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"SMA (20)"</span>, <span class="st">"EMA (0.1)"</span>, <span class="st">"Savitzky-Golay"</span>, <span class="st">"Lowess"</span>),</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"purple"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Explanation: - The <code>SMA()</code> function calculates the Simple Moving Average with a window size of 20 days. - The <code>EMA()</code> function calculates the Exponential Moving Average with a smoothing factor of 0.1. - The <code>sgolayfilt()</code> function applies the Savitzky-Golay filter with a polynomial order of 3 and a window size of 21. - The <code>lowess()</code> function applies Lowess smoothing with default parameters. - The original price series and smoothed series are plotted on the same graph using <code>plot()</code> and <code>lines()</code> functions. - The differences between the smoothing methods and their effectiveness in capturing the underlying trend can be observed from the plot.</p>
<p>Exercise 3:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr   1.1.4     ✔ readr   2.1.5
✔ forcats 1.0.0     ✔ stringr 1.5.1
✔ ggplot2 3.4.4     ✔ tibble  3.2.1
✔ purrr   1.0.2     ✔ tidyr   1.3.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks signal::filter(), stats::filter()
✖ dplyr::first()  masks xts::first()
✖ dplyr::lag()    masks stats::lag()
✖ dplyr::last()   masks xts::last()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for stationarity using the ADF test</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>adf_test <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(closing_prices)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(adf_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  closing_prices
Dickey-Fuller = -2.7663, Lag order = 11, p-value = 0.2539
alternative hypothesis: stationary</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If non-stationary, apply differencing</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (adf_test<span class="sc">$</span>p.value <span class="sc">&gt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  differenced_prices <span class="ot">&lt;-</span> <span class="fu">diff</span>(closing_prices)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove NAs from differenced series</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  differenced_prices <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(differenced_prices)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  adf_test_diff <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(differenced_prices)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(adf_test_diff)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(differenced_prices): p-value smaller than printed p-value</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  differenced_prices
Dickey-Fuller = -11.139, Lag order = 11, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>Explanation: - The <code>adf.test()</code> function performs the Augmented Dickey-Fuller (ADF) test to check for stationarity. - If the p-value of the ADF test is greater than 0.05, the series is considered non-stationary. - In case of non-stationarity, differencing is applied using the <code>diff()</code> function. - The ADF test is performed again on the differenced series to confirm stationarity.</p>
<p>Exercise 4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an ARIMA model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(closing_prices)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(arima_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: closing_prices 
ARIMA(0,1,1) with drift 

Coefficients:
          ma1   drift
      -0.0418  0.0991
s.e.   0.0264  0.0545

sigma^2 = 4.891:  log likelihood = -3335.72
AIC=6677.45   AICc=6677.47   BIC=6693.41

Training set error measures:
                       ME     RMSE      MAE         MPE     MAPE      MASE
Training set 5.192884e-05 2.209461 1.510575 -0.04057672 1.404191 0.9961854
                    ACF1
Training set 0.001037842</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast the next 30 days</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>forecast_30 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_model, <span class="at">h =</span> <span class="dv">30</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_30, <span class="at">main =</span> <span class="st">"ARIMA Forecast for Apple Inc. (AAPL) Closing Prices"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Explanation: - The <code>auto.arima()</code> function automatically selects the best ARIMA model parameters based on the AIC criterion. - The <code>summary()</code> function provides a summary of the fitted ARIMA model, including the coefficients and their significance. - The <code>forecast()</code> function is used to forecast the next 30 days of stock prices based on the fitted ARIMA model. - The forecasted values are plotted along with the original price series using the <code>plot()</code> function.</p>
<p>Exercise 5:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rugarch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: parallel</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rugarch'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    reduce</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    sigma</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the GARCH(1,1) model</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">mean.model =</span> <span class="fu">list</span>(<span class="at">armaOrder =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">variance.model =</span> <span class="fu">list</span>(<span class="at">garchOrder =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">model =</span> <span class="st">"sGARCH"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">submodel =</span> <span class="cn">NULL</span>),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">distribution.model =</span> <span class="st">"norm"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fixed.pars =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">omega =</span> <span class="fl">0.1</span>, <span class="at">alpha1 =</span> <span class="fl">0.1</span>, <span class="at">beta1 =</span> <span class="fl">0.8</span>))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a GARCH(1,1) process</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>garch_sim <span class="ot">&lt;-</span> <span class="fu">ugarchpath</span>(spec, <span class="at">n.sim =</span> <span class="dv">1000</span>, <span class="at">m.sim =</span> <span class="dv">1</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a GARCH(1,1) model to the simulated data</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>garch_fit <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(spec, garch_sim<span class="sc">@</span>path<span class="sc">$</span>seriesSim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .sgarchfit(spec = spec, data = data, out.sample = out.sample, : 
ugarchfit--&gt;warning: all parameters fixed...returning ugarchfilter object instead</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(garch_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
*------------------------------------*
*          GARCH Model Filter        *
*------------------------------------*

Conditional Variance Dynamics   
--------------------------------------
GARCH Model : sGARCH(1,1)
Mean Model  : ARFIMA(0,0,0)
Distribution    : norm 

Filter Parameters
---------------------------------------
          
mu     0.0
omega  0.1
alpha1 0.1
beta1  0.8

LogLikelihood : -1365.193 

Information Criteria
---------------------------------------
                   
Akaike       2.7304
Bayes        2.7304
Shibata      2.7304
Hannan-Quinn 2.7304

Weighted Ljung-Box Test on Standardized Residuals
---------------------------------------
                        statistic p-value
Lag[1]                     0.5906  0.4422
Lag[2*(p+q)+(p+q)-1][2]    0.8400  0.5532
Lag[4*(p+q)+(p+q)-1][5]    3.8527  0.2730
d.o.f=0
H0 : No serial correlation

Weighted Ljung-Box Test on Standardized Squared Residuals
---------------------------------------
                        statistic p-value
Lag[1]                   0.006391  0.9363
Lag[2*(p+q)+(p+q)-1][5]  0.370260  0.9757
Lag[4*(p+q)+(p+q)-1][9]  2.118920  0.8903
d.o.f=2

Weighted ARCH LM Tests
---------------------------------------
            Statistic Shape Scale P-Value
ARCH Lag[3]   0.02373 0.500 2.000  0.8776
ARCH Lag[5]   0.67806 1.440 1.667  0.8301
ARCH Lag[7]   2.05301 2.315 1.543  0.7061


Sign Bias Test
---------------------------------------
                   t-value   prob sig
Sign Bias           1.2965 0.1951    
Negative Sign Bias  0.1554 0.8765    
Positive Sign Bias  0.4377 0.6617    
Joint Effect        2.6983 0.4405    


Adjusted Pearson Goodness-of-Fit Test:
---------------------------------------
  group statistic p-value(g-1)
1    20     22.96       0.2391
2    30     37.58       0.1320
3    40     38.40       0.4971
4    50     43.90       0.6795</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the estimated parameters with the true values</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">coef</span>(garch_fit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mu  omega alpha1  beta1 
   0.0    0.1    0.1    0.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(garch_sim<span class="sc">@</span>model<span class="sc">$</span>pars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Level Fixed Include Estimate LB UB
mu         0.0     1       1        0 NA NA
ar         0.0     0       0        0 NA NA
ma         0.0     0       0        0 NA NA
arfima     0.0     0       0        0 NA NA
archm      0.0     0       0        0 NA NA
mxreg      0.0     0       0        0 NA NA
omega      0.1     1       1        0 NA NA
alpha1     0.1     1       1        0 NA NA
beta1      0.8     1       1        0 NA NA
gamma      0.0     0       0        0 NA NA
eta1       0.0     0       0        0 NA NA
eta2       0.0     0       0        0 NA NA
delta      0.0     0       0        0 NA NA
lambda     0.0     0       0        0 NA NA
vxreg      0.0     0       0        0 NA NA
skew       0.0     0       0        0 NA NA
shape      0.0     0       0        0 NA NA
ghlambda   0.0     0       0        0 NA NA
xi         0.0     0       0        0 NA NA</code></pre>
</div>
</div>
<p>In the updated code, the model specification is defined using <code>ugarchspec()</code> with the following changes: - The <code>fixed.pars</code> argument is used to specify the parameter values directly, ensuring that the names match the expected names. - The <code>submodel</code> argument in the <code>variance.model</code> is set to <code>NULL</code> to use the default GARCH(1,1) parameterization.</p>
<p>By specifying the parameter values using <code>fixed.pars</code> with the correct names, the error should be resolved, and the code should run without issues.</p>
<p>Here’s the explanation of the changes made: - <code>mu</code>: Represents the mean of the GARCH process. It is set to 0 in this example. - <code>omega</code>: Represents the constant term in the GARCH variance equation. It is set to 0.1 in this example. - <code>alpha1</code>: Represents the coefficient of the squared residual term in the GARCH variance equation. It is set to 0.1 in this example. - <code>beta1</code>: Represents the coefficient of the lagged variance term in the GARCH variance equation. It is set to 0.8 in this example.</p>
<p>By providing the parameter values directly using <code>fixed.pars</code>, you ensure that the parameter names match the expected names, and the <code>ugarchpath()</code> function should run without the parameter mismatch error.</p>
<p>Remember to adjust the parameter values according to your specific requirements and the characteristics of your GARCH process.</p>
<p>Exercise 6:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download historical stock prices for two related companies</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>aapl_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"AAPL"</span>, <span class="at">from =</span> <span class="st">"2018-01-01"</span>, <span class="at">to =</span> <span class="st">"2023-12-31"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>msft_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"MSFT"</span>, <span class="at">from =</span> <span class="st">"2018-01-01"</span>, <span class="at">to =</span> <span class="st">"2023-12-31"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the closing prices</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>aapl_prices <span class="ot">&lt;-</span> aapl_data<span class="sc">$</span>close</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>msft_prices <span class="ot">&lt;-</span> msft_data<span class="sc">$</span>close</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform cointegration analysis</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>coint_test <span class="ot">&lt;-</span> <span class="fu">ca.jo</span>(<span class="fu">cbind</span>(aapl_prices, msft_prices), <span class="at">type =</span> <span class="st">"trace"</span>, <span class="at">K =</span> <span class="dv">2</span>, <span class="at">ecdet =</span> <span class="st">"none"</span>, <span class="at">spec =</span> <span class="st">"transitory"</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coint_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
###################### 
# Johansen-Procedure # 
###################### 

Test type: trace statistic , with linear trend 

Eigenvalues (lambda):
[1] 0.0096484803 0.0002033327

Values of teststatistic and critical values of test:

          test 10pct  5pct  1pct
r &lt;= 1 |  0.31  6.50  8.18 11.65
r = 0  | 14.92 15.66 17.95 23.52

Eigenvectors, normalised to first column:
(These are the cointegration relations)

               aapl_prices.l1 msft_prices.l1
aapl_prices.l1      1.0000000      1.0000000
msft_prices.l1     -0.6176325      0.3785062

Weights W:
(This is the loading matrix)

              aapl_prices.l1 msft_prices.l1
aapl_prices.d   -0.017308401  -0.0001983142
msft_prices.d   -0.009527852  -0.0006805164</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate a VECM if cointegration is found</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (coint_test<span class="sc">@</span>teststat[<span class="dv">1</span>] <span class="sc">&gt;</span> coint_test<span class="sc">@</span>cval[<span class="dv">1</span>,<span class="dv">2</span>]) {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  vecm_model <span class="ot">&lt;-</span> <span class="fu">cajorls</span>(coint_test, <span class="at">r =</span> <span class="dv">1</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(vecm_model<span class="sc">$</span>rlm))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Explanation: - Historical stock prices for two related companies (AAPL and MSFT) are downloaded using <code>tq_get()</code> from the <code>tidyquant</code> package. - The closing prices for both stocks are extracted using <code>aapl_data$close</code> and <code>msft_data$close</code>. - The <code>urca</code> package is used for cointegration analysis. - <code>ca.jo()</code> performs the Johansen cointegration test to determine if there is a long-run relationship between the two price series. - If cointegration is found (i.e., the test statistic is greater than the critical value), a Vector Error Correction Model (VECM) is estimated using <code>cajorls()</code>. - The summary of the VECM is printed for interpretation.</p>
<p>Exercise 7:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conduct Granger causality test</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grangertest</span>(aapl_prices <span class="sc">~</span> msft_prices, <span class="at">order =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Granger causality test

Model 1: aapl_prices ~ Lags(aapl_prices, 1:1) + Lags(msft_prices, 1:1)
Model 2: aapl_prices ~ Lags(aapl_prices, 1:1)
  Res.Df Df      F  Pr(&gt;F)   
1   1505                     
2   1506 -1 10.054 0.00155 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grangertest</span>(msft_prices <span class="sc">~</span> aapl_prices, <span class="at">order =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Granger causality test

Model 1: msft_prices ~ Lags(msft_prices, 1:1) + Lags(aapl_prices, 1:1)
Model 2: msft_prices ~ Lags(msft_prices, 1:1)
  Res.Df Df      F Pr(&gt;F)
1   1505                 
2   1506 -1 0.4591 0.4982</code></pre>
</div>
</div>
<p>Explanation: - The <code>lmtest</code> package is used for conducting the Granger causality test. - <code>grangertest()</code> performs the Granger causality test to determine if the price of one stock can be used to predict the price of the other stock. - The test is conducted in both directions: AAPL prices predicting MSFT prices and vice versa. - The test results provide insights into the lead-lag relationship between the two stocks and their implications for investment and risk management strategies.</p>
<p>Exercise 8:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a random walk process</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>n_steps <span class="ot">&lt;-</span> <span class="fu">length</span>(closing_prices)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>drift <span class="ot">&lt;-</span> <span class="fl">0.001</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>volatility <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>initial_price <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> n_steps, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>steps[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>returns <span class="ot">&lt;-</span> drift <span class="sc">+</span> volatility <span class="sc">*</span> steps</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>sim_prices <span class="ot">&lt;-</span> initial_price <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">cumsum</span>(returns))</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the simulated price series</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_prices, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"Simulated Random Walk Process"</span>,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily returns</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>sim_returns <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(sim_prices))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with real stock price data</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>price_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(closing_prices[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_prices)]),</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Real =</span> <span class="fu">as.numeric</span>(closing_prices[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_prices)]),</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Simulated =</span> <span class="fu">as.numeric</span>(sim_prices))</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> price_data, <span class="fu">aes</span>(<span class="at">x =</span> Time)) <span class="sc">+</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Real, <span class="at">color =</span> <span class="st">"Real"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Simulated, <span class="at">color =</span> <span class="st">"Simulated"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Real"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Simulated"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of Real and Simulated Price Series"</span>,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare return distributions</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>return_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Return =</span> <span class="fu">c</span>(daily_returns, sim_returns),</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Real"</span>, <span class="fu">length</span>(daily_returns)),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">rep</span>(<span class="st">"Simulated"</span>, <span class="fu">length</span>(sim_returns))))</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> return_data, <span class="fu">aes</span>(<span class="at">x =</span> Return, <span class="at">fill =</span> Type)) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Real"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Simulated"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of Return Distributions"</span>,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Return"</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Type, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solutions_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Explanation: 1. Price Series Comparison: - We create a data frame <code>price_data</code> that contains the time index, real prices, and simulated prices. - Using <code>ggplot()</code>, we create a line plot with the time index on the x-axis and the price values on the y-axis. - We add two <code>geom_line()</code> layers to plot the real prices (in blue) and simulated prices (in red). - We set the colors manually using <code>scale_color_manual()</code> and provide appropriate labels using <code>labs()</code>. - Finally, we apply the <code>theme_minimal()</code> theme for a cleaner plot appearance.</p>
<ol start="2" type="1">
<li>Return Distributions Comparison:
<ul>
<li>We create a data frame <code>return_data</code> that combines the real returns and simulated returns, along with a type indicator.</li>
<li>Using <code>ggplot()</code>, we create a histogram plot with the return values on the x-axis and the density on the y-axis.</li>
<li>We use <code>geom_histogram()</code> to plot the histograms, with <code>..density..</code> mapping to show the density instead of count.</li>
<li>We set <code>alpha</code> to 0.7 for transparency and <code>position = "identity"</code> to overlay the histograms.</li>
<li>We add a <code>geom_density()</code> layer to display the density curves on top of the histograms.</li>
<li>We set the fill colors manually using <code>scale_fill_manual()</code>.</li>
<li>We use <code>facet_wrap()</code> to create separate panels for the real and simulated return distributions.</li>
<li>Finally, we apply the <code>theme_minimal()</code> theme for a cleaner plot appearance.</li>
</ul></li>
</ol>
<p>The resulting plots will show the comparison of the real and simulated price series over time, as well as the comparison of their return distributions side by side.</p>
<p>Explanation: - A random walk process is simulated with specified drift and volatility parameters. - The simulated price series is plotted using <code>plot()</code> with a line type. - Daily returns are calculated from the simulated price series using <code>diff()</code> and <code>log()</code>. - The simulated price series is compared with the real stock price data by plotting them together using <code>ggplot()</code> and <code>geom_line()</code>. - The return distributions of the real and simulated data are compared using histograms and density plots with <code>ggplot()</code>, <code>geom_histogram()</code>, and <code>geom_density()</code>. - The similarities and differences between the real and simulated series, as well as their implications for financial modeling and forecasting, can be discussed based on the visual comparison and return distributions.</p>
<p>Exercise 9: Backtesting ARMA Models:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download historical stock prices</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="st">"AAPL"</span>, <span class="at">from =</span> <span class="st">"2016-01-01"</span>, <span class="at">to =</span> <span class="st">"2021-12-31"</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> <span class="fu">Cl</span>(AAPL)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> prices[<span class="st">"2016-01-01/2019-12-31"</span>]</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> prices[<span class="st">"2020-01-01/2021-12-31"</span>]</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an ARMA(1, 1) model on the training set</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">arima</span>(train_data, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions for the testing set</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model, <span class="at">h =</span> <span class="fu">length</span>(test_data))</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate MAE and RMSE</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_data <span class="sc">-</span> predictions<span class="sc">$</span>mean))</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data <span class="sc">-</span> predictions<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling window approach</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>window_size <span class="ot">&lt;-</span> <span class="dv">252</span>  <span class="co"># One year of trading days</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>mae_rolling <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>rmse_rolling <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(test_data)) {</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> window_size) <span class="cf">next</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>  train_data_rolling <span class="ot">&lt;-</span> prices[(i <span class="sc">-</span> window_size <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>  test_data_rolling <span class="ot">&lt;-</span> prices[i]</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>  model_rolling <span class="ot">&lt;-</span> <span class="fu">arima</span>(train_data_rolling, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>  prediction_rolling <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model_rolling, <span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>  mae_rolling <span class="ot">&lt;-</span> <span class="fu">c</span>(mae_rolling, <span class="fu">abs</span>(test_data_rolling <span class="sc">-</span> prediction_rolling<span class="sc">$</span>mean[<span class="dv">1</span>]))</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>  rmse_rolling <span class="ot">&lt;-</span> <span class="fu">c</span>(rmse_rolling, (test_data_rolling <span class="sc">-</span> prediction_rolling<span class="sc">$</span>mean[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare static and rolling window approaches</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Static Approach:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:"</span>, mae, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE:"</span>, rmse, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rolling Window Approach:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:"</span>, <span class="fu">mean</span>(mae_rolling), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE:"</span>, <span class="fu">sqrt</span>(<span class="fu">mean</span>(rmse_rolling)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Excercise 10: Cross-Validating GARCH Models:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rugarch)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download historical stock prices</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="st">"AAPL"</span>, <span class="at">from =</span> <span class="st">"2016-01-01"</span>, <span class="at">to =</span> <span class="st">"2021-12-31"</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>returns <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(<span class="fu">Cl</span>(AAPL)))</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the time series cross-validation function</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>ts_cv <span class="ot">&lt;-</span> <span class="cf">function</span>(data, n_splits, model_func) {</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  split_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(n <span class="sc">/</span> n_splits)</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  mse_scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  mae_scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_splits <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    train_start <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> split_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    train_end <span class="ot">&lt;-</span> i <span class="sc">*</span> split_size</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    test_start <span class="ot">&lt;-</span> train_end <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    test_end <span class="ot">&lt;-</span> <span class="fu">min</span>(test_start <span class="sc">+</span> split_size <span class="sc">-</span> <span class="dv">1</span>, n)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    train_data <span class="ot">&lt;-</span> data[train_start<span class="sc">:</span>train_end]</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> data[test_start<span class="sc">:</span>test_end]</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(train_data)</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">n.ahead =</span> <span class="fu">length</span>(test_data), <span class="at">cond.dist =</span> <span class="st">"norm"</span>)</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>    mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data <span class="sc">-</span> predictions<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>    mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_data <span class="sc">-</span> predictions<span class="sc">$</span>mean))</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>    mse_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(mse_scores, mse)</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>    mae_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(mae_scores, mae)</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mse =</span> <span class="fu">mean</span>(mse_scores), <span class="at">mae =</span> <span class="fu">mean</span>(mae_scores)))</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the GARCH model function</span></span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>garch_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>  spec <span class="ot">&lt;-</span> <span class="fu">ugarchspec</span>(<span class="at">variance.model =</span> <span class="fu">list</span>(<span class="at">model =</span> <span class="st">"sGARCH"</span>, <span class="at">garchOrder =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean.model =</span> <span class="fu">list</span>(<span class="at">armaOrder =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">ugarchfit</span>(spec, data)</span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform time series cross-validation</span></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">ts_cv</span>(returns, <span class="at">n_splits =</span> <span class="dv">5</span>, <span class="at">model_func =</span> garch_model)</span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Cross-Validation Results:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MSE:"</span>, cv_results<span class="sc">$</span>mse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:"</span>, cv_results<span class="sc">$</span>mae, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GARCH model on the entire dataset</span></span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">garch_model</span>(returns)</span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Full Model Results:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MSE:"</span>, <span class="fu">mean</span>(full_model<span class="sc">@</span>fit<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:"</span>, <span class="fu">mean</span>(<span class="fu">abs</span>(full_model<span class="sc">@</span>fit<span class="sc">$</span>residuals)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Excercise 11: Comparing Forecast Models</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prophet)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Metrics)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Download historical sales data</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>sales_data <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"OLP"</span>, <span class="at">from =</span> <span class="st">"2011-01-01"</span>, <span class="at">to =</span> <span class="st">"2021-12-31"</span>, <span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(sales_data)[,<span class="dv">4</span>]</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform rolling window cross-validation</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>rolling_cv <span class="ot">&lt;-</span> <span class="cf">function</span>(data, n_splits, model_func) {</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  split_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(n <span class="sc">/</span> n_splits)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  mae_scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  rmse_scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  mape_scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_splits <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    train_start <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> split_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    train_end <span class="ot">&lt;-</span> i <span class="sc">*</span> split_size</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    test_start <span class="ot">&lt;-</span> train_end <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    test_end <span class="ot">&lt;-</span> <span class="fu">min</span>(test_start <span class="sc">+</span> split_size <span class="sc">-</span> <span class="dv">1</span>, n)</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    train_data <span class="ot">&lt;-</span> data[train_start<span class="sc">:</span>train_end]</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> data[test_start<span class="sc">:</span>test_end]</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(train_data)</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model, <span class="at">h =</span> <span class="fu">length</span>(test_data))</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    mae <span class="ot">&lt;-</span> <span class="fu">mae</span>(test_data, predictions<span class="sc">$</span>mean)</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    rmse <span class="ot">&lt;-</span> <span class="fu">rmse</span>(test_data, predictions<span class="sc">$</span>mean)</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    mape <span class="ot">&lt;-</span> <span class="fu">mape</span>(test_data, predictions<span class="sc">$</span>mean)</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>    mae_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(mae_scores, mae)</span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>    rmse_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(rmse_scores, rmse)</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>    mape_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(mape_scores, mape)</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mae =</span> <span class="fu">mean</span>(mae_scores), <span class="at">rmse =</span> <span class="fu">mean</span>(rmse_scores), <span class="at">mape =</span> <span class="fu">mean</span>(mape_scores)))</span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a><span class="co"># ARIMA model function</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>arima_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(data)</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS model function</span></span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>ets_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">ets</span>(data)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Prophet model function</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>prophet_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ds =</span> <span class="fu">as.Date</span>(<span class="fu">time</span>(data)), <span class="at">y =</span> <span class="fu">as.numeric</span>(data))</span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">prophet</span>(df)</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform rolling window cross-validation for each model</span></span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a>arima_results <span class="ot">&lt;-</span> <span class="fu">rolling_cv</span>(monthly_sales, <span class="at">n_splits =</span> <span class="dv">5</span>, <span class="at">model_func =</span> arima_model)</span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a>ets_results <span class="ot">&lt;-</span> <span class="fu">rolling_cv</span>(monthly_sales, <span class="at">n_splits =</span> <span class="dv">5</span>, <span class="at">model_func =</span> ets_model)</span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a>prophet_results <span class="ot">&lt;-</span> <span class="fu">rolling_cv</span>(monthly_sales, <span class="at">n_splits =</span> <span class="dv">5</span>, <span class="at">model_func =</span> prophet_model)</span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare model performance</span></span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ARIMA Results:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arima_results)</span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">ETS Results:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-71"><a href="#cb88-71" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ets_results)</span>
<span id="cb88-72"><a href="#cb88-72" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Prophet Results:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-73"><a href="#cb88-73" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(prophet_results)</span>
<span id="cb88-74"><a href="#cb88-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-75"><a href="#cb88-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Diebold-Mariano test</span></span>
<span id="cb88-76"><a href="#cb88-76" aria-hidden="true" tabindex="-1"></a>arima_errors <span class="ot">&lt;-</span> monthly_sales <span class="sc">-</span> <span class="fu">forecast</span>(<span class="fu">arima_model</span>(monthly_sales), <span class="at">h =</span> <span class="fu">length</span>(monthly_sales))<span class="sc">$</span>mean</span>
<span id="cb88-77"><a href="#cb88-77" aria-hidden="true" tabindex="-1"></a>ets_errors <span class="ot">&lt;-</span> monthly_sales <span class="sc">-</span> <span class="fu">forecast</span>(<span class="fu">ets_model</span>(monthly_sales), <span class="at">h =</span> <span class="fu">length</span>(monthly_sales))<span class="sc">$</span>mean</span>
<span id="cb88-78"><a href="#cb88-78" aria-hidden="true" tabindex="-1"></a>prophet_errors <span class="ot">&lt;-</span> monthly_sales <span class="sc">-</span> <span class="fu">forecast</span>(<span class="fu">prophet_model</span>(monthly_sales), <span class="at">h =</span> <span class="fu">length</span>(monthly_sales))<span class="sc">$</span>yhat</span>
<span id="cb88-79"><a href="#cb88-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-80"><a href="#cb88-80" aria-hidden="true" tabindex="-1"></a>dm_test_arima_ets <span class="ot">&lt;-</span> <span class="fu">dm.test</span>(arima_errors, ets_errors)</span>
<span id="cb88-81"><a href="#cb88-81" aria-hidden="true" tabindex="-1"></a>dm_test_arima_prophet <span class="ot">&lt;-</span> <span class="fu">dm.test</span>(arima_errors, prophet_errors)</span>
<span id="cb88-82"><a href="#cb88-82" aria-hidden="true" tabindex="-1"></a>dm_test_ets_prophet <span class="ot">&lt;-</span> <span class="fu">dm.test</span>(ets_errors, prophet_errors)</span>
<span id="cb88-83"><a href="#cb88-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-84"><a href="#cb88-84" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Diebold-Mariano Test Results:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-85"><a href="#cb88-85" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ARIMA vs ETS: p-value ="</span>, dm_test_arima_ets<span class="sc">$</span>p.value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-86"><a href="#cb88-86" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ARIMA vs Prophet: p-value ="</span>, dm_test_arima_prophet<span class="sc">$</span>p.value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-87"><a href="#cb88-87" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ETS vs Prophet: p-value ="</span>, dm_test_ets_prophet<span class="sc">$</span>p.value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Excercise 11: Tuning Hyperparameters with Cross-Validation</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download historical sales data</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>sales_data <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"OLP"</span>, <span class="at">from =</span> <span class="st">"2011-01-01"</span>, <span class="at">to =</span> <span class="st">"2021-12-31"</span>, <span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(sales_data)[,<span class="dv">4</span>]</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform time series cross-validation</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>ts_cv <span class="ot">&lt;-</span> <span class="cf">function</span>(data, n_splits, model_func, ...) {</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  split_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(n <span class="sc">/</span> n_splits)</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  mse_scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_splits <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    train_start <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> split_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>    train_end <span class="ot">&lt;-</span> i <span class="sc">*</span> split_size</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    test_start <span class="ot">&lt;-</span> train_end <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    test_end <span class="ot">&lt;-</span> <span class="fu">min</span>(test_start <span class="sc">+</span> split_size <span class="sc">-</span> <span class="dv">1</span>, n)</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    train_data <span class="ot">&lt;-</span> data[train_start<span class="sc">:</span>train_end]</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> data[test_start<span class="sc">:</span>test_end]</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">model_func</span>(train_data, ...)</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model, <span class="at">h =</span> <span class="fu">length</span>(test_data))</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data <span class="sc">-</span> predictions<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>    mse_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(mse_scores, mse)</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(mse_scores))</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid search function</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>grid_search <span class="ot">&lt;-</span> <span class="cf">function</span>(data, p_values, d_values, q_values) {</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>  best_score <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>  best_params <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p_values) {</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (d <span class="cf">in</span> d_values) {</span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (q <span class="cf">in</span> q_values) {</span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>        score <span class="ot">&lt;-</span> <span class="fu">ts_cv</span>(data, <span class="at">n_splits =</span> <span class="dv">5</span>, <span class="at">model_func =</span> arima, <span class="at">order =</span> <span class="fu">c</span>(p, d, q))</span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (score <span class="sc">&lt;</span> best_score) {</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a>          best_score <span class="ot">&lt;-</span> score</span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a>          best_params <span class="ot">&lt;-</span> <span class="fu">c</span>(p, d, q)</span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">best_params =</span> best_params, <span class="at">best_score =</span> best_score))</span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the range of hyperparameters</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>d_values <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a>q_values <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform grid search</span></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a>grid_search_results <span class="ot">&lt;-</span> <span class="fu">grid_search</span>(monthly_sales, p_values, d_values, q_values)</span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Best Hyperparameters:"</span>, grid_search_results<span class="sc">$</span>best_params, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Best Cross-Validation Score:"</span>, grid_search_results<span class="sc">$</span>best_score, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ARIMA model with the optimal hyperparameters</span></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">arima</span>(monthly_sales, <span class="at">order =</span> grid_search_results<span class="sc">$</span>best_params)</span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions for the next 12 months</span></span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">forecast</span>(best_model, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These sample solutions provide detailed implementations of the practical exercises using R and relevant packages. They cover various aspects of model evaluation and selection, including backtesting, cross-validation, model comparison, and hyperparameter tuning.</p>
<p>The first exercise demonstrates backtesting an ARMA model on stock price data, comparing static and rolling window approaches. The second exercise shows how to perform time series cross-validation for a GARCH model. The third exercise compares the performance of different forecasting models (ARIMA, ETS, and Prophet) using rolling window cross-validation and the</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./resources.html" class="pagination-link" aria-label="resources">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">resources</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./academic-integrity.html" class="pagination-link" aria-label="Advanced Financial Data Analytics Academic Integrity Policy">
        <span class="nav-page-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Advanced Financial Data Analytics Academic Integrity Policy</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>