<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Barry Quinn">

<title>Advanced Financial Data Analytics – 4&nbsp; Understanding Financial Data and Asset Returns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./time_series.html" rel="next">
<link href="./tools.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./primer.html">Core Concepts</a></li><li class="breadcrumb-item"><a href="./returns.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Understanding Financial Data and Asset Returns</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Financial Data Analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Core Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./primer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistics and Probability Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Toolkit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./returns.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Understanding Financial Data and Asset Returns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Financial times series econometrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayesian_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Machine Learning in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Advanced Material</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multilevel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Multilevel Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Causal inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colliderbias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Causal Salad, Endogeneity and collider bias</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Chapter solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./academic-integrity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Advanced Financial Data Analytics Academic Integrity Policy</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#theoretical-reasons" id="toc-theoretical-reasons" class="nav-link active" data-scroll-target="#theoretical-reasons"><span class="header-section-number">4.1</span> Theoretical Reasons</a></li>
  <li><a href="#transaction-costs" id="toc-transaction-costs" class="nav-link" data-scroll-target="#transaction-costs"><span class="header-section-number">4.2</span> Transaction Costs</a></li>
  <li><a href="#practical-reasons" id="toc-practical-reasons" class="nav-link" data-scroll-target="#practical-reasons"><span class="header-section-number">4.3</span> Practical Reasons</a></li>
  <li><a href="#asset-returns" id="toc-asset-returns" class="nav-link" data-scroll-target="#asset-returns"><span class="header-section-number">5</span> Asset Returns</a>
  <ul class="collapse">
  <li><a href="#one-period-simple-returns" id="toc-one-period-simple-returns" class="nav-link" data-scroll-target="#one-period-simple-returns"><span class="header-section-number">5.1</span> One-Period Simple Returns</a></li>
  <li><a href="#multiperiod-simple-returns" id="toc-multiperiod-simple-returns" class="nav-link" data-scroll-target="#multiperiod-simple-returns"><span class="header-section-number">5.2</span> Multiperiod Simple Returns</a></li>
  <li><a href="#time-interval-considerations" id="toc-time-interval-considerations" class="nav-link" data-scroll-target="#time-interval-considerations"><span class="header-section-number">5.3</span> Time Interval Considerations</a></li>
  <li><a href="#continuously-compounded-returns" id="toc-continuously-compounded-returns" class="nav-link" data-scroll-target="#continuously-compounded-returns"><span class="header-section-number">5.4</span> Continuously Compounded Returns</a></li>
  <li><a href="#portfolio-returns" id="toc-portfolio-returns" class="nav-link" data-scroll-target="#portfolio-returns"><span class="header-section-number">5.5</span> Portfolio Returns</a>
  <ul class="collapse">
  <li><a href="#simple-portfolio-returns" id="toc-simple-portfolio-returns" class="nav-link" data-scroll-target="#simple-portfolio-returns"><span class="header-section-number">5.5.1</span> Simple Portfolio Returns</a></li>
  <li><a href="#log-portfolio-returns" id="toc-log-portfolio-returns" class="nav-link" data-scroll-target="#log-portfolio-returns"><span class="header-section-number">5.5.2</span> Log Portfolio Returns</a></li>
  </ul></li>
  <li><a href="#adjustments-for-dividend-payments" id="toc-adjustments-for-dividend-payments" class="nav-link" data-scroll-target="#adjustments-for-dividend-payments"><span class="header-section-number">5.6</span> Adjustments for Dividend Payments</a></li>
  <li><a href="#excess-returns" id="toc-excess-returns" class="nav-link" data-scroll-target="#excess-returns"><span class="header-section-number">5.7</span> Excess Returns</a></li>
  <li><a href="#bond-yields-and-prices" id="toc-bond-yields-and-prices" class="nav-link" data-scroll-target="#bond-yields-and-prices"><span class="header-section-number">5.8</span> Bond Yields and Prices</a></li>
  <li><a href="#bond-yields-and-prices-1" id="toc-bond-yields-and-prices-1" class="nav-link" data-scroll-target="#bond-yields-and-prices-1"><span class="header-section-number">5.9</span> Bond Yields and Prices</a>
  <ul class="collapse">
  <li><a href="#coupon-rate" id="toc-coupon-rate" class="nav-link" data-scroll-target="#coupon-rate"><span class="header-section-number">5.9.1</span> Coupon Rate</a></li>
  <li><a href="#maturity-date" id="toc-maturity-date" class="nav-link" data-scroll-target="#maturity-date"><span class="header-section-number">5.9.2</span> Maturity Date</a></li>
  <li><a href="#factors-impacting-yields" id="toc-factors-impacting-yields" class="nav-link" data-scroll-target="#factors-impacting-yields"><span class="header-section-number">5.9.3</span> Factors Impacting Yields</a></li>
  <li><a href="#bond-categories" id="toc-bond-categories" class="nav-link" data-scroll-target="#bond-categories"><span class="header-section-number">5.9.4</span> Bond Categories</a></li>
  <li><a href="#bond-categories-1" id="toc-bond-categories-1" class="nav-link" data-scroll-target="#bond-categories-1"><span class="header-section-number">5.9.5</span> Bond Categories</a></li>
  </ul></li>
  <li><a href="#implied-volatility" id="toc-implied-volatility" class="nav-link" data-scroll-target="#implied-volatility"><span class="header-section-number">5.10</span> Implied Volatility</a></li>
  <li><a href="#implied-volatility-1" id="toc-implied-volatility-1" class="nav-link" data-scroll-target="#implied-volatility-1"><span class="header-section-number">5.11</span> Implied Volatility</a>
  <ul class="collapse">
  <li><a href="#options-pricing-basics" id="toc-options-pricing-basics" class="nav-link" data-scroll-target="#options-pricing-basics"><span class="header-section-number">5.11.1</span> Options Pricing Basics</a></li>
  <li><a href="#implied-volatility-2" id="toc-implied-volatility-2" class="nav-link" data-scroll-target="#implied-volatility-2"><span class="header-section-number">5.11.2</span> Implied Volatility</a></li>
  <li><a href="#explanation" id="toc-explanation" class="nav-link" data-scroll-target="#explanation"><span class="header-section-number">5.11.3</span> Explanation:</a></li>
  <li><a href="#cboe-volatility-index-vix" id="toc-cboe-volatility-index-vix" class="nav-link" data-scroll-target="#cboe-volatility-index-vix"><span class="header-section-number">5.11.4</span> CBOE Volatility Index (VIX)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#overlapping-returns-and-autocorrelation" id="toc-overlapping-returns-and-autocorrelation" class="nav-link" data-scroll-target="#overlapping-returns-and-autocorrelation"><span class="header-section-number">6</span> Overlapping Returns and Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6.1</span> References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./primer.html">Core Concepts</a></li><li class="breadcrumb-item"><a href="./returns.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Understanding Financial Data and Asset Returns</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Understanding Financial Data and Asset Returns</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Barry Quinn </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><img src="images/logos/DALL·E 2024-01-18 16.32.37 - Create a professional logo for an advanced financial data analytics course. The design should be vibrant, with a medium level of detail, balancing com.png" class="img-fluid" style="float: left; margin-right: 10px;;width:30.0%"></p>
<p>Financial time series, such as asset prices, exchange rates, and interest rates, are fundamental in econometric analysis. Unlike prices, returns are more commonly used due to their desirable statistical properties, such as stationarity and scale independence. This chapter will explore various aspects of financial returns.</p>
<p>g# We transform prices to returns</p>
<p>In financial econometrics, the focus on analyzing returns rather than prices is both theoretically and practically driven. Here’s a detailed explanation based on the book <span class="citation" data-cites="lo1997econometrics">Andrew W. Lo and MacKinlay (<a href="#ref-lo1997econometrics" role="doc-biblioref">1997</a>)</span></p>
<section id="theoretical-reasons" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="theoretical-reasons"><span class="header-section-number">4.1</span> Theoretical Reasons</h2>
<ol type="1">
<li><p><strong>Stationarity</strong>: Financial time series of prices are typically non-stationary, meaning their statistical properties (like mean and variance) change over time. This non-stationarity violates the basic assumptions of many econometric models. Returns, calculated as the percentage change in prices, are more likely to be stationary. Stationary data is crucial for applying many statistical and econometric techniques, as it ensures that the model’s parameters are constant over time.</p></li>
<li><p><strong>Difficulties with Non-Stationary Data</strong>: Working with non-stationary data can lead to spurious regression problems, where relationships between variables appear significant even when they are not. Returns typically exhibit weaker forms of non-stationarity compared to prices, reducing the risk of such misleading results.</p></li>
<li><p><strong>Economic Theory Alignment</strong>: Returns represent the reward for bearing risk, which is a fundamental concept in financial economics. Analyzing returns aligns more closely with economic theories that focus on risk and reward, such as the Capital Asset Pricing Model (CAPM) and Efficient Market Hypothesis (EMH).</p></li>
<li><p><strong>Volatility Modeling</strong>: Returns facilitate the modeling of volatility, a key aspect in financial markets. Models like GARCH (Generalized Autoregressive Conditional Heteroskedasticity) are designed to capture the volatility clustering often observed in returns, which is not as apparent when analyzing prices directly.</p></li>
</ol>
</section>
<section id="transaction-costs" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="transaction-costs"><span class="header-section-number">4.2</span> Transaction Costs</h2>
<ol type="1">
<li><p><strong>Round Trip Transaction Costs</strong>: This concept usually refers to the total costs incurred in completing a full investment cycle – buying and then subsequently selling a financial asset. These costs include brokerage fees, bid-ask spreads, taxes, and other transaction expenses.</p></li>
<li><p><strong>Impact on Returns Analysis</strong>: When considering round trip transaction costs in the context of financial markets, it’s important to analyze returns rather than prices. This is because the actual return on an investment needs to account for these costs. For instance, even if an asset’s price appreciates, the net return might be lower (or even negative) after accounting for transaction costs.</p></li>
<li><p><strong>Modeling and Risk Assessment</strong>: In econometric models, incorporating transaction costs is crucial for realistic risk and return assessments. These costs can significantly impact the viability and attractiveness of trading strategies, especially those involving frequent transactions.</p></li>
<li><p><strong>Behavioral Implications</strong>: Transaction costs also influence investor behavior. High costs might deter frequent trading, thereby affecting the liquidity and price volatility of assets.</p></li>
</ol>
</section>
<section id="practical-reasons" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="practical-reasons"><span class="header-section-number">4.3</span> Practical Reasons</h2>
<ol type="1">
<li><p><strong>Comparability</strong>: Returns standardize the performance across different assets, allowing for meaningful comparisons. For instance, a $5 increase in a $10 stock is a 50% return, whereas the same $5 increase in a $100 stock is only a 5% return. Analyzing prices would not capture this difference in performance.</p></li>
<li><p><strong>Simplicity in Modeling</strong>: Modeling returns simplifies the mathematical complexity involved in dealing with non-stationary price series. This simplification allows for more straightforward interpretation and application of models.</p></li>
<li><p><strong>Risk Management</strong>: In financial risk management, the focus is often on the variability of returns (i.e., risk) rather than absolute price levels. Analyzing returns directly aligns with this focus, aiding in the development of risk management strategies.</p></li>
<li><p><strong>Efficient Market Considerations</strong>: In efficient markets, it is believed that all available information is already reflected in current prices. Therefore, the focus is on changes in prices (returns), which reflect new information, rather than on the price levels themselves.</p></li>
</ol>
</section>
<section id="asset-returns" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Asset Returns</h1>
<section id="one-period-simple-returns" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="one-period-simple-returns"><span class="header-section-number">5.1</span> One-Period Simple Returns</h2>
<p>Simple returns represent the percentage change in asset price over a single period and are calculated as follows:</p>
<p><span class="math display">\[ R_t = \frac{P_t - P_{t-1}}{P_{t-1}} \]</span></p>
<p>where ( R_t ) is the return at time ( t ), ( P_t ) is the price at time ( t ), and ( P_{t-1} ) is the price at time ( t-1 ).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsfe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyverse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 'prices' is a vector of asset prices</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>prices<span class="ot">&lt;-</span><span class="fu">monte_carlo_paths</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>prices<span class="ot">&lt;-</span><span class="fu">filter</span>(prices, possible_path_no<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>returns <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">diff</span>(prices<span class="sc">$</span>sample_path)) <span class="sc">/</span> <span class="fu">lag</span>(prices<span class="sc">$</span>sample_path, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in na.omit(diff(prices$sample_path))/lag(prices$sample_path, 1): longer
object length is not a multiple of shorter object length</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>returns <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(returns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multiperiod-simple-returns" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="multiperiod-simple-returns"><span class="header-section-number">5.2</span> Multiperiod Simple Returns</h2>
<p>For multiple periods, simple returns are compounded. The formula for a return over ( n ) periods is:</p>
<p><span class="math display">\[ R_{t, t+n} = \prod_{i=1}^{n} (1 + R_{t+i}) - 1 \]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To calculate multiperiod returns</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>multiperiod_return <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> returns) <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="time-interval-considerations" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="time-interval-considerations"><span class="header-section-number">5.3</span> Time Interval Considerations</h2>
<p>The time interval of returns (daily, monthly, yearly) significantly impacts their magnitude and volatility. Annualizing returns involves scaling them to a yearly basis, usually by multiplying (for simple returns) or exponentiation (for log returns) by the number of periods per year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>daily_return <span class="ot">&lt;-</span> returns</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Annualizing daily returns (assuming 252 trading days in a year)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>annualized_return <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> daily_return) <span class="sc">^</span> <span class="dv">252</span> <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="continuously-compounded-returns" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="continuously-compounded-returns"><span class="header-section-number">5.4</span> Continuously Compounded Returns</h2>
<p>Continuously compounded, or log returns, are computed as the natural logarithm of the price ratio:</p>
<p><span class="math display">\[ r_t = \ln\left(\frac{P_t}{P_{t-1}}\right) \]</span></p>
<p>Log returns are time-additive, making them suitable for multi-period returns calculation and econometric modeling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>log_returns <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(prices<span class="sc">$</span>sample_path))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>log_returns <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(log_returns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="portfolio-returns" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="portfolio-returns"><span class="header-section-number">5.5</span> Portfolio Returns</h2>
<p>Portfolio returns are the weighted average of individual asset returns, reflecting the portfolio composition.</p>
<section id="simple-portfolio-returns" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="simple-portfolio-returns"><span class="header-section-number">5.5.1</span> Simple Portfolio Returns</h3>
<p>The simple return of a portfolio is the sum of the weighted returns of each asset.</p>
<p><span class="math display">\[ R_{portfolio} = \sum_{i=1}^{N} w_i R_i \]</span></p>
<p>where ( w_i ) is the weight of the ( i^{th} ) asset in the portfolio, and ( R_i ) is its return.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 'weights' is a vector of portfolio weights and 'returns' is a matrix of returns</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>portfolio_return <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(weights <span class="sc">*</span> returns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="log-portfolio-returns" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="log-portfolio-returns"><span class="header-section-number">5.5.2</span> Log Portfolio Returns</h3>
<p>For log returns, the portfolio return is not a simple weighted sum but can be approximated for small individual returns.</p>
</section>
</section>
<section id="adjustments-for-dividend-payments" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="adjustments-for-dividend-payments"><span class="header-section-number">5.6</span> Adjustments for Dividend Payments</h2>
<p>Total return, considering both price changes and dividends, gives a more complete picture of an asset’s performance.</p>
<p><span class="math display">\[ R_{total} = \frac{P_t + D_t - P_{t-1}}{P_{t-1}} \]</span></p>
<p>where ( D_t ) is the dividend paid at time ( t ).</p>
</section>
<section id="excess-returns" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="excess-returns"><span class="header-section-number">5.7</span> Excess Returns</h2>
<p>Excess return is the return of an asset over and above a benchmark or risk-free rate, crucial in risk-adjusted performance analysis.</p>
<p><span class="math display">\[ R_{excess} = R_{asset} - R_{benchmark} \]</span></p>
</section>
<section id="bond-yields-and-prices" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="bond-yields-and-prices"><span class="header-section-number">5.8</span> Bond Yields and Prices</h2>
<p>Here is an expansion of the Bond Yields and Prices section with more details and examples on the sub-topics:</p>
</section>
<section id="bond-yields-and-prices-1" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="bond-yields-and-prices-1"><span class="header-section-number">5.9</span> Bond Yields and Prices</h2>
<p>Bonds are debt instruments issued by governments, municipalities, and corporations to raise capital. Key bond features include:</p>
<section id="coupon-rate" class="level3" data-number="5.9.1">
<h3 data-number="5.9.1" class="anchored" data-anchor-id="coupon-rate"><span class="header-section-number">5.9.1</span> Coupon Rate</h3>
<p>The coupon rate is the periodic interest rate paid on the par value, typically semiannually. It represents an annual percentage yield to the investor based on invested capital. Coupon payments are calculated as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pv <span class="ot">&lt;-</span> <span class="dv">100</span>  </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cpn <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cpn_payment <span class="ot">&lt;-</span> pv <span class="sc">*</span> cpn  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cpn_payment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</section>
<section id="maturity-date" class="level3" data-number="5.9.2">
<h3 data-number="5.9.2" class="anchored" data-anchor-id="maturity-date"><span class="header-section-number">5.9.2</span> Maturity Date</h3>
<p>The maturity date determines the bond’s term or tenor. Longer-dated bonds generally pay higher yields to compensate investors for reduced liquidity and higher interest rate risk over time. Maturity also impacts the relationship between price and yield.</p>
</section>
<section id="factors-impacting-yields" class="level3" data-number="5.9.3">
<h3 data-number="5.9.3" class="anchored" data-anchor-id="factors-impacting-yields"><span class="header-section-number">5.9.3</span> Factors Impacting Yields</h3>
<p>Several factors determine the base yield investors demand on bonds:</p>
<p><strong>Credit Risk</strong> - Probability that principal and interest will not be repaid as obligated. Lower rated bonds offer higher yields to offset higher default risk.</p>
<p><strong>Time to Maturity</strong> - As discussed, longer maturities require higher yields.</p>
<p><strong>Tax Treatment</strong> - Tax exemptions for municipal bonds allow them to pay lower pre-tax yields.</p>
<p><strong>Liquidity</strong> - Easier tradability allows lower yields to compensate for reduced risk.</p>
<p><strong>Interest Rates</strong> - Prevailing rates determine a baseline for yield levels across bonds.</p>
<p>For example, 10-year BBB corporate bonds currently offer higher yields than 10-year Treasuries due to higher credit risk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: xts</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
######################### Warning from 'xts' package ##########################
#                                                                             #
# The dplyr lag() function breaks how base R's lag() function is supposed to  #
# work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or       #
# source() into this session won't work correctly.                            #
#                                                                             #
# Use stats::lag() to make sure you're not using dplyr::lag(), or you can add #
# conflictRules('dplyr', exclude = 'lag') to your .Rprofile to stop           #
# dplyr from breaking base R's lag() function.                                #
#                                                                             #
# Code in packages is not affected. It's protected by R's namespace mechanism #
# Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #
#                                                                             #
###############################################################################</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'xts'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: TTR</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>corp_ytm <span class="ot">&lt;-</span> <span class="fl">0.049</span>  <span class="co"># 4.9% YTM</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tbill_ytm<span class="ot">&lt;-</span> <span class="fl">0.038</span>   <span class="co"># 3.8% YTM </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Corporate Bond Premium = "</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>(corp_ytm <span class="sc">-</span> tbill_ytm), <span class="dv">2</span>), <span class="st">" basis points"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Corporate Bond Premium = 1.1 basis points"</code></pre>
</div>
</div>
</section>
<section id="bond-categories" class="level3" data-number="5.9.4">
<h3 data-number="5.9.4" class="anchored" data-anchor-id="bond-categories"><span class="header-section-number">5.9.4</span> Bond Categories</h3>
<p>Sure, here is an expansion on the different bond categories:</p>
</section>
<section id="bond-categories-1" class="level3" data-number="5.9.5">
<h3 data-number="5.9.5" class="anchored" data-anchor-id="bond-categories-1"><span class="header-section-number">5.9.5</span> Bond Categories</h3>
<p>There are a few major categories of bonds:</p>
<p><strong>Treasury Bonds</strong> - Issued by the federal government and considered essentially default risk-free. Treasuries make up the largest single debt market and serve benchmark pricing and yield roles. Different types are distinguished by maturity:</p>
<ul>
<li>Treasury bills - Maturities less than 1 year</li>
<li>Treasury notes - 2 to 10 year maturities</li>
<li>Treasury bonds - Over 10 years</li>
</ul>
<p><strong>Municipal Bonds</strong> - Issued by state and local governments to finance public infrastructure projects. Key features include tax exemption and thus lower yields along with higher default risk than federal government:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taxable equivalent yield</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>tax_rate <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>tax_exempt_yield <span class="ot">&lt;-</span> <span class="fl">0.02</span>  </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>equivalent_taxable_yield <span class="ot">&lt;-</span> tax_exempt_yield <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> tax_rate) </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>equivalent_taxable_yield</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02857143</code></pre>
</div>
</div>
<p><strong>Corporate Bonds</strong> - Debt issued by corporations and are categorized by credit ratings. Investment-grade bonds (BBB-or higher rating) offer modest yields while high-yield “junk” bonds pay much higher yields due to elevated default risk.</p>
<p><strong>Mortgage Bonds</strong> – Debt collateralized by pools of mortgage loans with interest and principal used to make payments.</p>
<p>In terms of total volume outstanding in the US, Treasury and corporate bonds have the greatest market size followed by mortgage-related and municipal securities. Understanding differences across bond categories assists with portfolio allocation and relative value comparisons.</p>
</section>
</section>
<section id="implied-volatility" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="implied-volatility"><span class="header-section-number">5.10</span> Implied Volatility</h2>
<p>Here is an expanded Implied Volatility section with more details and R code examples:</p>
</section>
<section id="implied-volatility-1" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="implied-volatility-1"><span class="header-section-number">5.11</span> Implied Volatility</h2>
<p>Volatility measures how rapidly an asset’s price moves. It is a key input in options pricing models.</p>
<section id="options-pricing-basics" class="level3" data-number="5.11.1">
<h3 data-number="5.11.1" class="anchored" data-anchor-id="options-pricing-basics"><span class="header-section-number">5.11.1</span> Options Pricing Basics</h3>
<p>Options give holders the right, but not the obligation, to buy or sell the underlying asset by the expiration date at a pre-determined price (strike price). In return, buyers pay an upfront premium. Two types exist:</p>
<ul>
<li><strong>Call Options:</strong> Right to buy the asset</li>
<li><strong>Put Options:</strong> Right to sell the asset</li>
</ul>
<p>For instance, a stock call option may have a $100 strike with $5 premium.</p>
<p>The classic Black-Scholes formula prices options based on current stock price, strike price, volatility, risk-free rate, and time to expiration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Black-Scholes Call Option Example</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">100</span>     <span class="co"># Asset price  </span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span>     <span class="co"># Strike price</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span> <span class="co"># Volatility </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.01</span>    <span class="co"># Risk-free rate  </span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">1</span>       <span class="co"># Years til expiration  </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(S<span class="sc">/</span>K)<span class="sc">+</span>(r<span class="sc">+</span>sigma<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>t) <span class="sc">/</span> (sigma<span class="sc">*</span><span class="fu">sqrt</span>(t))  </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d1 <span class="sc">-</span> sigma<span class="sc">*</span><span class="fu">sqrt</span>(t)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>call_price <span class="ot">&lt;-</span> S <span class="sc">*</span> <span class="fu">pnorm</span>(d1) <span class="sc">-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> t) <span class="sc">*</span> <span class="fu">pnorm</span>(d2)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Call Price:"</span>, <span class="fu">round</span>(call_price, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Call Price: 12.37"</code></pre>
</div>
</div>
</section>
<section id="implied-volatility-2" class="level3" data-number="5.11.2">
<h3 data-number="5.11.2" class="anchored" data-anchor-id="implied-volatility-2"><span class="header-section-number">5.11.2</span> Implied Volatility</h3>
<p>Rather than estimating volatility based on historical prices, implied volatility uses the known market price and inverts the options pricing model to solve for volatility. It represents the market’s forward-looking expectation of volatility over the option’s life.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsfe)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Market parameters</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># Current stock price</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># Strike price</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Time to maturity in years</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co"># Risk-free interest rate</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># Dividend yield</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>market_price <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># Actual call price observed in the market</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate implied volatility using the BlackScholes function from MyFinancePackage</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>implied_vol <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="cf">function</span>(x) <span class="fu">BlackScholes</span>(<span class="st">"call"</span>, S, K, T, r, x, q) <span class="sc">-</span> market_price, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">5</span>))<span class="sc">$</span>root</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Implied Volatility:"</span>, <span class="fu">round</span>(implied_vol <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="explanation" class="level3" data-number="5.11.3">
<h3 data-number="5.11.3" class="anchored" data-anchor-id="explanation"><span class="header-section-number">5.11.3</span> Explanation:</h3>
<ul>
<li><p><strong>BlackScholes Function</strong>: This function is defined to calculate the price of a call option based on the Black-Scholes model. It takes the current stock price (<code>S0</code>), strike price (<code>K</code>), time to maturity (<code>T</code>), risk-free interest rate (<code>r</code>), volatility (<code>sigma</code>), and dividend yield (<code>q</code>) as inputs.</p></li>
<li><p><strong>Market Parameters</strong>: These variables represent the conditions under which you’re trying to find the implied volatility. <code>S</code> is the current stock price, <code>K</code> is the strike price, <code>T</code> is the time to expiration in years, <code>r</code> is the risk-free interest rate, and <code>q</code> is the dividend yield. <code>market_price</code> is the observed market price of the call option.</p></li>
<li><p><strong>Implied Volatility Calculation</strong>: The <code>uniroot</code> function finds the volatility value that, when used in the <code>BlackScholes</code> function, results in the option price matching the market price of the call option. The <code>interval = c(0.01, 5)</code> argument specifies the search interval for the volatility (from 1% to 500%). Adjust this interval based on your market expectations and the typical volatility range of the underlying asset.</p></li>
<li><p><strong>Print Statement</strong>: Finally, the calculated implied volatility is printed out as a percentage with two decimal places.</p></li>
</ul>
<p>Comparing implied volatility vs.&nbsp;historical volatility shows when options may be relatively expensive or cheap based on realized volatility. The CBOE Volatility Index (VIX) takes this concept further by aggregating implied volatility across S&amp;P 500 index options to measure broad market volatility expectations.</p>
</section>
<section id="cboe-volatility-index-vix" class="level3" data-number="5.11.4">
<h3 data-number="5.11.4" class="anchored" data-anchor-id="cboe-volatility-index-vix"><span class="header-section-number">5.11.4</span> CBOE Volatility Index (VIX)</h3>
<p>The VIX represents the market’s consensus expectation for S&amp;P 500 volatility over the next 30 days based on SPX option prices. Known as the “fear gauge,” it enables trading volatility directly:</p>
<pre><code># Calculate VIX based on SPX option prices
spx_calls &lt;- getOptionChain("SPX") 
call_prices &lt;- spx_calls$lastPrice  

vix &lt;- variance_swap(log(call_prices), spx_calls$strike, 
                     S0=mean(spx_calls$strike), ttm=30/365)
print(paste("VIX:", round(100*sqrt(vix), 2)))</code></pre>
<p>Rather than a direct index, the VIX allows trading volatility expectations through VIX futures contracts and VIX-linked ETFs and ETNs. Monitoring the VIX shows when traders anticipate unstable markets compared to realized volatility. Comparing VIX levels to historical averages provides context on volatility regime shifts.</p>
</section>
</section>
</section>
<section id="overlapping-returns-and-autocorrelation" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Overlapping Returns and Autocorrelation</h1>
<p>A common approach in empirical asset pricing research involves using time-series data of asset returns. For example, a researcher may collect daily stock return data over several years to study predictive signals, risk factors, or other relationships. However, the use of overlapping multiperiod returns can introduce statistical complications <span class="citation" data-cites="lo1990econometric">Andrew W. Lo and MacKinlay (<a href="#ref-lo1990econometric" role="doc-biblioref">1990</a>)</span>.</p>
<p>The issue arises because adjacent return observations share common days, inducing autocorrelation in the time-series data. For instance, 20-day returns with a 1-day shift comprise 19 identical daily returns. This overlap across return intervals leads to spurious correlation, violating assumptions of independently and identically distributed (i.i.d) observations under classical statistical models.</p>
<p>Consequences include biased coefficient estimates, understated standard errors, and over-rejection of null hypotheses during hypothesis testing. In effect, the observed sample size overstates the effective size for calculating precision and confidence levels. The series appears to contain more information than is actually present.</p>
<p>Consider the simulated autocorrelated return process:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)  </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.5</span>), <span class="at">n=</span><span class="dv">100</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(r)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="returns_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Regressing another random series x onto r yields biased estimates and t-stats:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>) </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> r <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.8639 -0.8560  0.0053  1.0721  3.8671 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.2624     0.1483   1.769     0.08 .  
x             0.9920     0.1483   6.687 1.41e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.483 on 98 degrees of freedom
Multiple R-squared:  0.3133,    Adjusted R-squared:  0.3063 
F-statistic: 44.72 on 1 and 98 DF,  p-value: 1.407e-09</code></pre>
</div>
</div>
<p>There are several potential approaches for handling overlapping data:</p>
<ol type="1">
<li>Utilize non-overlapping returns - e.g.&nbsp;annual instead of monthly. This eliminates overlap bias but reduces sample size considerably.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fu">tibble</span>(r)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>slices<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(r), <span class="dv">12</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>r_annual <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span> <span class="fu">slice</span>(slices)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Model the autocorrelation structure like an ARMA process. Specify this correlation during estimation for properly adjusted estimates and standard errors. However, this relies on correctly specifying the autocorrelation structure.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ar1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(y, <span class="at">xreg=</span>x, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Employ statistical techniques robust to certain autocorrelation structures, such as heteroskedasticity and autocorrelation (HAC) corrections to standard errors. For example, Newey-West standard errors.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich) </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.5</span>), <span class="at">n=</span><span class="dv">100</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> r <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(mod, <span class="at">vcov =</span> <span class="fu">NeweyWest</span>(mod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

            Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept) 0.057822   0.191822  0.3014    0.7637    
x           0.973118   0.125354  7.7629 8.101e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Overlapping returns has relevance in many empirical finance settings but warrants additional consideration during econometric modeling and analysis. Failing to account for the induced autocorrelation can undermine results and conclusions. For example, <span class="citation" data-cites="richardson1991tests">Richardson and Smith (<a href="#ref-richardson1991tests" role="doc-biblioref">1991</a>)</span> investigate daily stock return regressions and find that positive autocorrelation from overlapping intervals can falsely indicate significant predictability when the true process contains only white noise.</p>
<section id="references" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="references"><span class="header-section-number">6.1</span> References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-lo1997econometrics" class="csl-entry" role="listitem">
Lo, Andrew W., and A. Craig MacKinlay. 1997. <em>The Econometrics of Financial Markets</em>. Princeton University Press.
</div>
<div id="ref-lo1990econometric" class="csl-entry" role="listitem">
Lo, Andrew W, and A Craig MacKinlay. 1990. <span>“An Econometric Analysis of Nonsynchronous Trading.”</span> <em>Journal of Econometrics</em> 45 (1-2): 181–211.
</div>
<div id="ref-richardson1991tests" class="csl-entry" role="listitem">
Richardson, Matthew, and Tom Smith. 1991. <span>“Tests of Financial Models in the Presence of Overlapping Observations.”</span> <em>The Review of Financial Studies</em> 4 (2): 227–54.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./tools.html" class="pagination-link" aria-label="Toolkit">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Toolkit</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./time_series.html" class="pagination-link" aria-label="Financial times series econometrics">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Financial times series econometrics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>