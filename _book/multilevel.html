<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Barry Quinn">

<title>Don't Fence Me In – 8&nbsp; Modeling Multilevel Financial Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./causal.html" rel="next">
<link href="./ml.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./multilevel.html">Advanced Material</a></li><li class="breadcrumb-item"><a href="./multilevel.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Multilevel Financial Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Don’t Fence Me In</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Core Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./primer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistics and Probability Primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Toolkit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Understanding Financial Data and Asset Returns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Financial times series econometrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayesian_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Machine Learning in Finance</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Advanced Material</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multilevel.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Multilevel Financial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Causal inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colliderbias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Causal Salad, Endogeneity and collider bias</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Chapter solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./academic-integrity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Advanced Financial Data Analytics Academic Integrity Policy</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">8.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#group-level-data-models" id="toc-group-level-data-models" class="nav-link" data-scroll-target="#group-level-data-models"><span class="header-section-number">8.1.1</span> Group-Level Data Models</a></li>
  <li><a href="#hierarchical-linear-models-hlms" id="toc-hierarchical-linear-models-hlms" class="nav-link" data-scroll-target="#hierarchical-linear-models-hlms"><span class="header-section-number">8.1.2</span> Hierarchical Linear Models (HLMs)</a></li>
  <li><a href="#panel-econometric-methods" id="toc-panel-econometric-methods" class="nav-link" data-scroll-target="#panel-econometric-methods"><span class="header-section-number">8.1.3</span> Panel Econometric Methods</a></li>
  <li><a href="#bayesian-vs-frequentist-perspective" id="toc-bayesian-vs-frequentist-perspective" class="nav-link" data-scroll-target="#bayesian-vs-frequentist-perspective"><span class="header-section-number">8.1.4</span> Bayesian vs Frequentist Perspective</a></li>
  <li><a href="#financial-applications" id="toc-financial-applications" class="nav-link" data-scroll-target="#financial-applications"><span class="header-section-number">8.1.5</span> Financial Applications</a></li>
  <li><a href="#discussion-and-future-directions" id="toc-discussion-and-future-directions" class="nav-link" data-scroll-target="#discussion-and-future-directions"><span class="header-section-number">8.1.6</span> Discussion and Future Directions</a></li>
  <li><a href="#critiquing-the-models" id="toc-critiquing-the-models" class="nav-link" data-scroll-target="#critiquing-the-models"><span class="header-section-number">8.1.7</span> Critiquing the models</a></li>
  <li><a href="#verdict" id="toc-verdict" class="nav-link" data-scroll-target="#verdict"><span class="header-section-number">8.1.8</span> Verdict</a></li>
  <li><a href="#introduction-to-gmm-in-multilevel-modeling" id="toc-introduction-to-gmm-in-multilevel-modeling" class="nav-link" data-scroll-target="#introduction-to-gmm-in-multilevel-modeling"><span class="header-section-number">8.1.9</span> Introduction to GMM in Multilevel Modeling</a></li>
  <li><a href="#excercise" id="toc-excercise" class="nav-link" data-scroll-target="#excercise"><span class="header-section-number">8.1.10</span> Excercise</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./multilevel.html">Advanced Material</a></li><li class="breadcrumb-item"><a href="./multilevel.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Multilevel Financial Data</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modeling Multilevel Financial Data</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Barry Quinn </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>This chapter delves into the intricacies of modeling multilevel data, specifically focusing on comparing hierarchical models and panel econometrics within both Bayesian and frequentist perspectives. We will discuss each approach’s underlying assumptions, strengths, weaknesses, and their application in finance. By understanding these methods, researchers and practitioners alike can make more informed decisions when selecting appropriate techniques for analyzing complex financial datasets.</p>
<section id="introduction" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.1</span> Introduction</h2>
<p>Financial research often involves handling multilevel data structures where observations are nested or cross-classified across different levels (e.g., firms, industries, time periods). The choice of an adequate statistical methodology is crucial as it impacts estimation accuracy and subsequent policy recommendations. This chapter explores two prominent approaches – hierarchical modeling and panel econometrics – along with Bayesian and frequentist viewpoints.</p>
<section id="group-level-data-models" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="group-level-data-models"><span class="header-section-number">8.1.1</span> Group-Level Data Models</h3>
<p>Before diving into specific modeling techniques, we introduce basic concepts related to group-level data. Let yij denote the observation i from level j, where i = 1, …, ni and j = 1, …, J. In this setup, traditional single-level regression models assume that all observations come from one homogeneous population. However, this assumption may not hold true in many cases, leading us to consider alternative frameworks capable of accounting for heterogeneity across groups.</p>
</section>
<section id="hierarchical-linear-models-hlms" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="hierarchical-linear-models-hlms"><span class="header-section-number">8.1.2</span> Hierarchical Linear Models (HLMs)</h3>
<p>Hierarchical linear models, also known as mixed effects models or multi-level models, explicitly account for the variation between higher-level units by incorporating random components at multiple levels. HLMs have several advantages over classical regression techniques:</p>
<ul>
<li>They allow for explicit modeling of correlations among lower-level units within groups;</li>
<li>They enable estimates of variance components at various levels;</li>
<li>They provide shrinkage estimators which borrow strength from similar groups, improving prediction performance;</li>
<li>They accommodate unbalanced designs with varying numbers of lower-level units per group.</li>
</ul>
</section>
<section id="panel-econometric-methods" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="panel-econometric-methods"><span class="header-section-number">8.1.3</span> Panel Econometric Methods</h3>
<p>Panel econometrics focuses on longitudinal data analysis using fixed effect and random effect models. These methods address potential endogeneity issues arising due to omitted variable bias and dynamic panels. Key features include:</p>
<ul>
<li>Accounting for individual-specific unobserved heterogeneity through either fixed or random effects;</li>
<li>Capturing serial correlation via lagged dependent variables or error terms;</li>
<li>Allowing for robust inference using clustered standard errors.</li>
</ul>
</section>
<section id="bayesian-vs-frequentist-perspective" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="bayesian-vs-frequentist-perspective"><span class="header-section-number">8.1.4</span> Bayesian vs Frequentist Perspective</h3>
<p>From a philosophical standpoint, Bayesian and frequentist statisticians differ in their interpretation of probability. While frequentists view probability as long-run relative frequency, Bayesians interpret it as degree of belief based on prior knowledge. Consequently, these contrasting views lead to disparities in how parameters are estimated and interpreted.</p>
</section>
<section id="financial-applications" class="level3" data-number="8.1.5">
<h3 data-number="8.1.5" class="anchored" data-anchor-id="financial-applications"><span class="header-section-number">8.1.5</span> Financial Applications</h3>
<p>Multilevel modeling has found extensive use in financial research, particularly in corporate finance, asset pricing, and risk management. Some examples include:</p>
<ul>
<li>Analyzing firm-level data to estimate industry-specific cost functions while controlling for firm characteristics;</li>
<li>Examining portfolio returns to assess market efficiency after adjusting for cross-sectional dependence;</li>
<li>Investigating credit rating agencies’ consistency in assigning ratings across countries and time periods.</li>
</ul>
</section>
<section id="discussion-and-future-directions" class="level3" data-number="8.1.6">
<h3 data-number="8.1.6" class="anchored" data-anchor-id="discussion-and-future-directions"><span class="header-section-number">8.1.6</span> Discussion and Future Directions</h3>
<p>While both hierarchical modeling and panel econometrics offer valuable insights into multilevel data analysis, they exhibit distinct characteristics requiring careful consideration before implementation. Moreover, recent advancements in computational algorithms facilitate seamless integration of Bayesian and frequentist paradigms, opening up new possibilities for sophisticated financial modeling. As such, further exploration of these topics promises exciting developments in our quest to better understand complex financial phenomena.</p>
</section>
<section id="critiquing-the-models" class="level3" data-number="8.1.7">
<h3 data-number="8.1.7" class="anchored" data-anchor-id="critiquing-the-models"><span class="header-section-number">8.1.7</span> Critiquing the models</h3>
<section id="fixed-effect-models" class="level4" data-number="8.1.7.1">
<h4 data-number="8.1.7.1" class="anchored" data-anchor-id="fixed-effect-models"><span class="header-section-number">8.1.7.1</span> Fixed Effect Models</h4>
<p>Fixed effect models (FEM) are widely used for addressing unobserved heterogeneity at the unit level. They capture nuisance parameters by including dummy variables for each entity. Advantages of FEM include:</p>
<ul>
<li>Consistent parameter estimates even if the unobserved effects are correlated with covariates;</li>
<li>Within-group comparisons allowing for causal inferences under certain conditions;</li>
<li>Robustness to misspecification of functional forms compared to pooled OLS.</li>
</ul>
<p>However, there are limitations associated with FEM:</p>
<ul>
<li>Loss of degrees of freedom due to inclusion of numerous indicator variables, potentially affecting precision;</li>
<li>Assumption of zero mean for unobserved effects might be violated, resulting in biased coefficient estimates;</li>
<li>Cannot directly incorporate time-invariant predictors without resorting to first difference transformation or other approximations.</li>
</ul>
</section>
<section id="random-effect-models" class="level4" data-number="8.1.7.2">
<h4 data-number="8.1.7.2" class="anchored" data-anchor-id="random-effect-models"><span class="header-section-number">8.1.7.2</span> Random Effect Models</h4>
<p>Random effect models (REM), alternatively referred to as mixed effects models, treat unobserved heterogeneity as stochastic rather than deterministic entities. REM provides benefits such as:</p>
<ul>
<li>Efficient estimation since only deviations from the overall mean need to be estimated for each unit;</li>
<li>Ability to model temporal dynamics using random slope coefficients;</li>
<li>Preservation of degrees of freedom compared to FEM.</li>
</ul>
<p>Conversely, drawbacks of REM encompass:</p>
<ul>
<li>Strict exogeneity assumption required for consistent estimation;</li>
<li>Sensitivity to specification of distributional form for random effects;</li>
<li>Potential inconsistency if unobserved effects are correlated with covariates (violation of “random effects” assumption).</li>
</ul>
</section>
<section id="hierarchical-models" class="level4" data-number="8.1.7.3">
<h4 data-number="8.1.7.3" class="anchored" data-anchor-id="hierarchical-models"><span class="header-section-number">8.1.7.3</span> Hierarchical Models</h4>
<p>Hierarchical linear models (HLMs), as previously discussed, allow for multiple levels of nesting and cross-classification. Compared to FEM and REM, HLM offers unique advantages:</p>
<ul>
<li>Capability to handle complex data structures involving three or more levels;</li>
<li>Direct estimation of variance components at each level;</li>
<li>Shrinkage estimators providing improved predictions, especially for small clusters;</li>
<li>Increased power in detecting significant effects across groups.</li>
</ul>
<p>Nevertheless, HLM entails its own set of challenges:</p>
<ul>
<li>Computationally intensive due to iterative maximum likelihood procedures or Markov Chain Monte Carlo simulations;</li>
<li>Prone to identification problems when high correlations exist between predictors at different levels;</li>
<li>Requires careful justification of assuming normality for residuals and random effects distributions.</li>
</ul>
</section>
</section>
<section id="verdict" class="level3" data-number="8.1.8">
<h3 data-number="8.1.8" class="anchored" data-anchor-id="verdict"><span class="header-section-number">8.1.8</span> Verdict</h3>
<p>In conclusion, no single model outperforms others universally. Researchers must carefully evaluate their dataset’s structure, research questions, and theoretical background to determine whether FEM, REM, or HLM is most suitable for their purposes. Additionally, sensitivity analyses should be conducted to ensure results’ robustness across different modeling choices.</p>
</section>
<section id="introduction-to-gmm-in-multilevel-modeling" class="level3" data-number="8.1.9">
<h3 data-number="8.1.9" class="anchored" data-anchor-id="introduction-to-gmm-in-multilevel-modeling"><span class="header-section-number">8.1.9</span> Introduction to GMM in Multilevel Modeling</h3>
<p>Multilevel modeling, also known as hierarchical or mixed-effects modeling, is a powerful statistical technique that allows for the analysis of data with a nested or hierarchical structure. In the context of financial data analytics, multilevel models are particularly relevant when dealing with data that has multiple levels of variability, such as observations clustered within firms, industries, or countries. These models capture the dependencies and heterogeneity present in the data, providing more accurate and insightful analyses.</p>
<p>Traditional estimation methods, such as Ordinary Least Squares (OLS) or Maximum Likelihood (ML), often face challenges when applied to multilevel models. These methods may produce biased or inefficient estimates in the presence of correlated errors, unobserved heterogeneity, or endogeneity. Moreover, they may not fully exploit the information contained in the hierarchical structure of the data.</p>
<p>The Generalized Method of Moments (GMM) offers a flexible and robust alternative for estimating multilevel models. GMM is a general framework that encompasses many traditional estimators as special cases. It relies on specifying moment conditions that the parameters should satisfy, rather than making strong distributional assumptions. This feature makes GMM particularly appealing for multilevel modeling, as it can handle complex error structures and allow for more reliable inference.</p>
<p>The key advantages of using GMM in multilevel modeling include:</p>
<ol type="1">
<li><p>Consistency: GMM provides consistent estimates even when the distributional assumptions of traditional methods are violated, as long as the moment conditions are correctly specified.</p></li>
<li><p>Efficiency: By incorporating information from multiple levels and allowing for an optimal weighting of moment conditions, GMM can produce more efficient estimates compared to traditional methods.</p></li>
<li><p>Flexibility: GMM allows researchers to specify economically interesting or theoretically motivated moment conditions without the need to fully specify the likelihood function.</p></li>
<li><p>Robustness: GMM estimates are robust to certain types of model misspecification, such as heteroskedasticity or serial correlation, when appropriate moment conditions are used.</p></li>
</ol>
<p>In the following sections, we will delve into the details of GMM estimation in multilevel models, providing a practical guide with R code examples. We will also explore the Bayesian perspective and recent advances in machine learning that can enhance the application of GMM in financial data analytics.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("lme4")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate multilevel data</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>n_firms <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>firm_effect <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rep</span>(firm_effect, <span class="at">each =</span> n_obs) <span class="sc">+</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">firm =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_firms, <span class="at">each =</span> n_obs), <span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a multilevel model using lme4 package</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> firm), <span class="at">data =</span> data)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we simulate a multilevel dataset with observations nested within firms. We then fit a multilevel model using the <code>lmer()</code> function from the <code>lme4</code> package, which uses ML estimation by default. The model specifies a fixed effect for the covariate <code>x</code> and a random intercept for each firm. The <code>summary()</code> function provides the estimated coefficients and their standard errors.</p>
<p>While this example uses ML estimation, it serves as a starting point to illustrate the structure of multilevel models in R. In the subsequent sections, we will explore how GMM can be employed to estimate these models and the advantages it offers over traditional methods.</p>
<section id="gmm-estimation-in-multilevel-models" class="level4" data-number="8.1.9.1">
<h4 data-number="8.1.9.1" class="anchored" data-anchor-id="gmm-estimation-in-multilevel-models"><span class="header-section-number">8.1.9.1</span> GMM Estimation in Multilevel Models</h4>
<p>To apply GMM estimation in multilevel models, we need to specify the moment conditions that the parameters should satisfy. These moment conditions are based on the assumptions about the relationships between the variables and the errors in the model.</p>
<p>Consider a two-level model with observations nested within groups (e.g., firms, industries, or countries). Let <span class="math inline">\(y_{ij}\)</span> denote the response variable for observation <span class="math inline">\(i\)</span> in group <span class="math inline">\(j\)</span>, <span class="math inline">\(x_{ij}\)</span> be a vector of covariates, <span class="math inline">\(\beta\)</span> be the vector of fixed effects, <span class="math inline">\(u_j\)</span> be the random effect for group <span class="math inline">\(j\)</span>, and <span class="math inline">\(\varepsilon_{ij}\)</span> be the error term. The model can be written as:</p>
<p><span class="math inline">\(y_{ij} = x_{ij}'\beta + u_j + \varepsilon_{ij}\)</span></p>
<p>where <span class="math inline">\(u_j \sim N(0, \sigma_u^2)\)</span> and <span class="math inline">\(\varepsilon_{ij} \sim N(0, \sigma_{\varepsilon}^2)\)</span>.</p>
<p>The moment conditions for this model can be derived from the orthogonality conditions between the errors and the covariates. For example, we can specify the following moment conditions:</p>
<ol type="1">
<li><span class="math inline">\(E[x_{ij}(y_{ij} - x_{ij}'\beta - u_j)] = 0\)</span>: The covariates are uncorrelated with the errors.</li>
<li><span class="math inline">\(E[u_j] = 0\)</span>: The random effects have zero mean.</li>
<li><span class="math inline">\(E[u_j^2] = \sigma_u^2\)</span>: The variance of the random effects is <span class="math inline">\(\sigma_u^2\)</span>.</li>
<li><span class="math inline">\(E[\varepsilon_{ij}^2] = \sigma_{\varepsilon}^2\)</span>: The variance of the error terms is <span class="math inline">\(\sigma_{\varepsilon}^2\)</span>.</li>
</ol>
<p>The GMM estimator minimizes the weighted sum of squared deviations of the sample moments from their theoretical counterparts. The weighting matrix <span class="math inline">\(W\)</span> is chosen to be the inverse of the variance-covariance matrix of the moment conditions. The optimal weighting matrix is typically estimated using an iterative procedure.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gmm")</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmm)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate multilevel data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n_firms <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>firm_effect <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rep</span>(firm_effect, <span class="at">each =</span> n_obs) <span class="sc">+</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">firm =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_firms, <span class="at">each =</span> n_obs), <span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the moment conditions</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>moment_conditions <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, data) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> data<span class="sc">$</span>y <span class="sc">-</span> beta[<span class="dv">1</span>] <span class="sc">-</span> beta[<span class="dv">2</span>] <span class="sc">*</span> data<span class="sc">$</span>x</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(residuals, residuals <span class="sc">*</span> data<span class="sc">$</span>x)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(moments)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform GMM estimation</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>gmm_model <span class="ot">&lt;-</span> <span class="fu">gmm</span>(moment_conditions, <span class="at">data =</span> data, <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we simulate a multilevel dataset similar to the previous section. We then define the moment conditions using a function <code>moment_conditions()</code> that takes the parameter vector <code>beta</code> and the data as inputs. The moment conditions are based on the orthogonality between the residuals and the covariates.</p>
<p>We perform the GMM estimation using the <code>gmm()</code> function from the <code>gmm</code> package. The <code>moment_conditions</code> function is passed as the first argument, followed by the data and initial parameter values. The <code>summary()</code> function provides the estimated coefficients, standard errors, and model diagnostics.</p>
<p><strong>GMM estimation in multilevel models offers several advantages:</strong></p>
<ol type="1">
<li>It allows for consistent estimation even when the errors are correlated within groups or when there is unobserved heterogeneity.</li>
<li>It provides a flexible framework for incorporating moment conditions based on economic theory or prior knowledge.</li>
<li>It can handle endogenous covariates by using instrumental variables as additional moment conditions.</li>
</ol>
<p>However, GMM estimation also has some limitations. The efficiency of the estimator depends on the choice of the weighting matrix, which can be challenging to estimate accurately in finite samples. Moreover, the performance of GMM may be sensitive to the number and quality of the moment conditions.</p>
<p>In the following sections, we will discuss model specification, moment selection, inference, and diagnostics to ensure the reliability and robustness of GMM estimates in multilevel models.</p>
</section>
<section id="model-specification-and-moment-selection" class="level4" data-number="8.1.9.2">
<h4 data-number="8.1.9.2" class="anchored" data-anchor-id="model-specification-and-moment-selection"><span class="header-section-number">8.1.9.2</span> Model Specification and Moment Selection</h4>
<p>Correct specification of the moment conditions is crucial for the consistency and efficiency of GMM estimates in multilevel models. The moment conditions should capture the key assumptions and restrictions implied by the underlying economic theory or domain knowledge. Misspecified moment conditions can lead to biased and inconsistent estimates.</p>
<p>When specifying the moment conditions, researchers should consider the following guidelines:</p>
<ol type="1">
<li><p>Identify the sources of endogeneity: Determine which covariates are potentially correlated with the errors and require instrumental variables.</p></li>
<li><p>Select valid and relevant instruments: Choose instruments that are uncorrelated with the errors but strongly correlated with the endogenous covariates. Weak or invalid instruments can lead to biased estimates and poor finite sample performance.</p></li>
<li><p>Incorporate theoretical restrictions: Use economic theory to derive moment conditions that reflect the relationships between variables and parameters of interest.</p></li>
<li><p>Exploit the hierarchical structure: Leverage the multilevel nature of the data by specifying moment conditions at different levels of the hierarchy, such as group-level moments or cross-level interactions.</p></li>
<li><p>Ensure overidentification: Include more moment conditions than parameters to be estimated, allowing for the assessment of model fit and the validity of moment conditions.</p></li>
</ol>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate multilevel data with endogenous covariate</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>n_firms <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>firm_effect <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs)  <span class="co"># Instrument</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_firms <span class="sc">*</span> n_obs, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rep</span>(firm_effect, <span class="at">each =</span> n_obs) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> error</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>x_endo <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> z <span class="sc">+</span> error  <span class="co"># Endogenous covariate</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">firm =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_firms, <span class="at">each =</span> n_obs), <span class="at">x =</span> x_endo, <span class="at">z =</span> z, <span class="at">y =</span> y)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the moment conditions</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>moment_conditions <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, data) {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> data<span class="sc">$</span>y <span class="sc">-</span> beta[<span class="dv">1</span>] <span class="sc">-</span> beta[<span class="dv">2</span>] <span class="sc">*</span> data<span class="sc">$</span>x</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(residuals, residuals <span class="sc">*</span> data<span class="sc">$</span>z)  <span class="co"># Instrument as moment condition</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(moments)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform GMM estimation</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>gmm_model <span class="ot">&lt;-</span> <span class="fu">gmm</span>(moment_conditions, <span class="at">data =</span> data, <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we simulate a multilevel dataset with an endogenous covariate <code>x</code>. The instrument <code>z</code> is generated independently of the error term. We specify the moment conditions using the orthogonality between the residuals and the instrument <code>z</code>. By including the instrument as a moment condition, we address the endogeneity problem.</p>
<p>To assess the validity of the moment conditions and the model fit, we can use specification tests such as the J-test (Hansen’s test) or the Sargan test. These tests evaluate the overidentifying restrictions and provide evidence of the appropriateness of the moment conditions.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform J-test</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>J_test <span class="ot">&lt;-</span> gmm<span class="sc">::</span><span class="fu">specTest</span>(gmm_model)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(J_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>specTest()</code> function from the <code>gmm</code> package performs the J-test, which tests the null hypothesis that the overidentifying restrictions are valid. A small p-value suggests that the moment conditions may be misspecified.</p>
<p>Researchers can also use simulation studies to evaluate the performance of different moment conditions and assess the robustness of the GMM estimates to misspecification. By generating data under various scenarios and comparing the estimates to the true parameters, researchers can gain insights into the sensitivity of the results to the choice of moment conditions.</p>
<p>Model selection techniques, such as the Akaike Information Criterion (AIC) or the Bayesian Information Criterion (BIC), can be employed to compare different specifications of moment conditions and choose the most appropriate model.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute AIC and BIC</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(gmm_model)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(gmm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>AIC()</code> and <code>BIC()</code> functions calculate the respective information criteria for the GMM model, allowing for model comparison and selection.</p>
<p>In summary, careful specification and selection of moment conditions are essential for the validity and reliability of GMM estimates in multilevel models. Researchers should draw upon economic theory, domain knowledge, and empirical evidence to guide their choice of moment conditions. Specification tests and model selection techniques can aid in assessing the appropriateness of the chosen moments and ensuring the robustness of the results.</p>
</section>
<section id="inference-and-model-diagnostics" class="level4" data-number="8.1.9.3">
<h4 data-number="8.1.9.3" class="anchored" data-anchor-id="inference-and-model-diagnostics"><span class="header-section-number">8.1.9.3</span> Inference and Model Diagnostics</h4>
<p>After estimating the GMM model for multilevel data, it is crucial to assess the reliability of the estimates and perform model diagnostics to ensure the validity of the inferences drawn from the analysis.</p>
<p>Inference in GMM estimation involves computing standard errors and confidence intervals for the estimated parameters. The standard errors provide a measure of the precision of the estimates and are used to construct confidence intervals and conduct hypothesis tests.</p>
<p>In multilevel GMM estimation, the standard errors need to account for the clustering of observations within groups. One approach is to use cluster-robust standard errors, which adjust for the potential correlation of errors within clusters. Cluster-robust standard errors are consistent even in the presence of heteroskedasticity and within-cluster error correlation.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate GMM model with cluster-robust standard errors</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>gmm_model <span class="ot">&lt;-</span> <span class="fu">gmm</span>(moment_conditions, <span class="at">data =</span> data, <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov =</span> <span class="st">"clustered"</span>, <span class="at">cluster =</span> data<span class="sc">$</span>firm)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_model, <span class="at">robust =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we estimate the GMM model using the <code>gmm()</code> function and specify the <code>vcov</code> argument as “clustered” to obtain cluster-robust standard errors. The <code>cluster</code> argument indicates the variable that defines the clusters (in this case, the <code>firm</code> variable). The <code>summary()</code> function with the <code>robust = TRUE</code> argument provides the robust standard errors and t-statistics.</p>
<p>Model diagnostics in GMM estimation involve assessing the validity of the moment conditions and testing for model misspecification. Two commonly used specification tests are the J-test (Hansen’s test) and the Sargan test.</p>
<p>The J-test evaluates the overall validity of the moment conditions by testing the overidentifying restrictions. It assesses whether the sample moments are close to zero when evaluated at the estimated parameter values. A large J-statistic or a small p-value suggests that the moment conditions may be misspecified.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform J-test</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>J_test <span class="ot">&lt;-</span> gmm<span class="sc">::</span><span class="fu">specTest</span>(gmm_model)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(J_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>specTest()</code> function from the <code>gmm</code> package performs the J-test and provides the test statistic and p-value.</p>
<p>The Sargan test is similar to the J-test but is based on the weighted sum of squared residuals. It tests the validity of the overidentifying restrictions under the assumption of homoskedastic errors. Like the J-test, a large Sargan statistic or a small p-value indicates potential model misspecification.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Sargan test</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Sargan_test <span class="ot">&lt;-</span> gmm<span class="sc">::</span><span class="fu">specTest</span>(gmm_model, <span class="at">type =</span> <span class="st">"Sargan"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Sargan_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>specTest()</code> function with the <code>type = "Sargan"</code> argument performs the Sargan test.</p>
<p>In addition to specification tests, researchers can also examine the residuals of the GMM model to check for patterns or anomalies that may suggest model misspecification. Plotting the residuals against the fitted values or the covariates can help detect any systematic deviations or heteroskedasticity.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract residuals from the GMM model</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(gmm_model)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot residuals against fitted values</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(gmm_model), residuals, <span class="at">xlab =</span> <span class="st">"Fitted Values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code extracts the residuals from the GMM model and plots them against the fitted values. The horizontal line at zero helps identify any systematic patterns or deviations.</p>
<p>If the specification tests indicate model misspecification or if the residual plots reveal problematic patterns, researchers should reconsider the choice of moment conditions, explore alternative specifications, or consider more advanced techniques such as the continuously updating GMM estimator (CUE) or the empirical likelihood approach.</p>
<p>In summary, inference and model diagnostics are essential steps in GMM estimation for multilevel models. Cluster-robust standard errors account for within-cluster error correlation, while specification tests and residual diagnostics help assess the validity of the moment conditions and identify potential model misspecification. By carefully examining these aspects, researchers can ensure the reliability and robustness of their GMM estimates and draw valid inferences from the analysis.</p>
</section>
<section id="bayesian-perspective-on-gmm-in-multilevel-models" class="level4" data-number="8.1.9.4">
<h4 data-number="8.1.9.4" class="anchored" data-anchor-id="bayesian-perspective-on-gmm-in-multilevel-models"><span class="header-section-number">8.1.9.4</span> Bayesian Perspective on GMM in Multilevel Models</h4>
<p>The Bayesian framework offers an alternative perspective on GMM estimation in multilevel models. Bayesian GMM (BGMM) combines the advantages of GMM, such as the ability to handle endogeneity and moment conditions, with the benefits of Bayesian inference, including the incorporation of prior information and the ability to quantify uncertainty in the parameter estimates.</p>
<p>In the Bayesian framework, prior distributions are specified for the parameters of interest, reflecting the researcher’s prior knowledge or beliefs about the parameters before observing the data. The prior distributions are then updated with the information from the data, yielding the posterior distributions of the parameters.</p>
<p>The BGMM approach involves specifying a likelihood function for the data and a set of moment conditions that the parameters should satisfy. The likelihood function describes the probabilistic relationship between the observed data and the parameters, while the moment conditions capture the economic or theoretical restrictions on the parameters.</p>
<p>The posterior distribution of the parameters is obtained by combining the likelihood function, the moment conditions, and the prior distributions using Bayes’ theorem. The resulting posterior distribution provides a complete characterization of the uncertainty in the parameter estimates, allowing for probability statements and credible intervals.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rbgmm"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rbgmm)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the likelihood function</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, data) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> theta[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  sigma_u <span class="ot">&lt;-</span> <span class="fu">exp</span>(theta[<span class="dv">3</span>])</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  sigma_e <span class="ot">&lt;-</span> <span class="fu">exp</span>(theta[<span class="dv">4</span>])</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> data<span class="sc">$</span>y <span class="sc">-</span> beta[<span class="dv">1</span>] <span class="sc">-</span> beta[<span class="dv">2</span>] <span class="sc">*</span> data<span class="sc">$</span>x</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  group_means <span class="ot">&lt;-</span> <span class="fu">tapply</span>(residuals, data<span class="sc">$</span>firm, mean)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  log_lik <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dnorm</span>(residuals, <span class="at">mean =</span> <span class="fu">rep</span>(group_means, <span class="at">each =</span> n_obs), <span class="at">sd =</span> sigma_e, <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(<span class="fu">dnorm</span>(group_means, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma_u, <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(log_lik)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the moment conditions</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>moment_conditions <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, data) {</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> theta[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> data<span class="sc">$</span>y <span class="sc">-</span> beta[<span class="dv">1</span>] <span class="sc">-</span> beta[<span class="dv">2</span>] <span class="sc">*</span> data<span class="sc">$</span>x</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(residuals, residuals <span class="sc">*</span> data<span class="sc">$</span>z)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(moments)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the prior distributions</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>prior_sd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) {</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  prior_lik <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dnorm</span>(theta, <span class="at">mean =</span> prior_mean, <span class="at">sd =</span> prior_sd, <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prior_lik)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform BGMM estimation</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>bgmm_model <span class="ot">&lt;-</span> <span class="fu">rbgmm</span>(likelihood, moment_conditions, prior, <span class="at">data =</span> data, <span class="at">n_iter =</span> <span class="dv">10000</span>, <span class="at">burn_in =</span> <span class="dv">1000</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bgmm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we use the <code>rbgmm</code> package to perform Bayesian GMM estimation. We specify the likelihood function, which describes the probability of observing the data given the parameters. The likelihood function incorporates the multilevel structure of the data by including both the individual-level residuals and the group-level random effects.</p>
<p>We also specify the moment conditions, which are similar to those used in the frequentist GMM estimation. The prior distributions for the parameters are defined using a prior function, which assigns normal priors to the fixed effects and log-normal priors to the variance components.</p>
<p>The <code>rbgmm()</code> function performs the BGMM estimation using Markov Chain Monte Carlo (MCMC) methods. The <code>n_iter</code> argument specifies the total number of MCMC iterations, while <code>burn_in</code> indicates the number of initial iterations to discard as burn-in.</p>
<p>The <code>summary()</code> function provides a summary of the posterior distributions, including the posterior means, standard deviations, and credible intervals for the parameters.</p>
<p>The Bayesian approach offers several advantages in the context of multilevel GMM estimation:</p>
<ol type="1">
<li><p>Incorporation of prior information: Bayesian methods allow researchers to incorporate prior knowledge or beliefs about the parameters through the specification of prior distributions. This can be particularly useful when there is limited data or when there are strong theoretical expectations about the parameter values.</p></li>
<li><p>Quantification of uncertainty: The posterior distributions obtained from Bayesian estimation provide a complete characterization of the uncertainty in the parameter estimates. This allows for probability statements and credible intervals, which can be more intuitive and informative than the point estimates and confidence intervals obtained from frequentist methods.</p></li>
<li><p>Flexibility in modeling: Bayesian methods offer flexibility in specifying complex likelihood functions and incorporating hierarchical structures in the model. This can be advantageous when dealing with multilevel data or when the distributional assumptions of the data are non-standard.</p></li>
</ol>
<p>However, the Bayesian approach also has some limitations:</p>
<ol type="1">
<li><p>Specification of prior distributions: The choice of prior distributions can have a substantial impact on the posterior inferences, especially when the sample size is small or the data are not very informative. Researchers need to carefully consider the sensitivity of the results to different prior specifications.</p></li>
<li><p>Computational complexity: Bayesian estimation often involves computationally intensive MCMC methods, which can be time-consuming and require careful convergence diagnostics. The computational burden may increase with the complexity of the model and the size of the data.</p></li>
<li><p>Interpretation of results: Bayesian results are interpreted in terms of probability statements and credible intervals, which may be less familiar to researchers accustomed to frequentist inference. It is important to clearly communicate the interpretation of Bayesian results to avoid confusion or misinterpretation.</p></li>
</ol>
<p>Despite these limitations, the Bayesian perspective on GMM estimation in multilevel models offers a valuable complement to the frequentist approach. By combining the strengths of GMM and Bayesian inference, researchers can obtain more comprehensive and informative inferences about the parameters of interest while accounting for the hierarchical structure of the data.</p>
</section>
<section id="machine-learning-advances-in-gmm-estimation" class="level4" data-number="8.1.9.5">
<h4 data-number="8.1.9.5" class="anchored" data-anchor-id="machine-learning-advances-in-gmm-estimation"><span class="header-section-number">8.1.9.5</span> Machine Learning Advances in GMM Estimation</h4>
<p>Machine learning techniques have been increasingly applied to GMM estimation in multilevel models to improve the efficiency and robustness of the estimates. These techniques leverage the power of data-driven algorithms to handle high-dimensional data, select relevant moment conditions, and mitigate the impact of model misspecification.</p>
<p>One prominent machine learning approach in GMM estimation is regularization. Regularization methods, such as Lasso (Least Absolute Shrinkage and Selection Operator) and Ridge regression, introduce penalty terms to the GMM objective function to constrain the magnitude of the parameter estimates and perform variable selection.</p>
<p>Lasso regularization, in particular, has gained popularity in GMM estimation due to its ability to simultaneously estimate parameters and select relevant moment conditions. By imposing an L1-norm penalty on the parameters, Lasso encourages sparsity and sets some parameter estimates exactly to zero, effectively performing variable selection.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"glmnet"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for Lasso GMM</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> data)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the GMM objective function with Lasso penalty</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>gmm_objective <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, lambda) {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> X <span class="sc">%*%</span> beta</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, X) <span class="sc">*</span> residuals</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  gmm_loss <span class="ot">&lt;-</span> <span class="fu">colSums</span>(moments)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  lasso_penalty <span class="ot">&lt;-</span> lambda <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(beta))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(gmm_loss) <span class="sc">+</span> lasso_penalty)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Lasso GMM estimation</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>lambda_seq <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>lasso_gmm <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lambda_seq, <span class="cf">function</span>(lambda) {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(<span class="at">par =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(X)), <span class="at">fn =</span> gmm_objective, <span class="at">lambda =</span> lambda)<span class="sc">$</span>par</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Lasso GMM solution path</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lambda_seq, <span class="fu">t</span>(<span class="fu">sapply</span>(lasso_gmm, <span class="cf">function</span>(x) x[<span class="dv">2</span>])), <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Lambda"</span>, <span class="at">ylab =</span> <span class="st">"Parameter Estimates"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we use the <code>glmnet</code> package to perform Lasso GMM estimation. We define the GMM objective function, which includes the moment conditions and the Lasso penalty term. The Lasso penalty is controlled by the tuning parameter <code>lambda</code>, which determines the strength of regularization.</p>
<p>We estimate the Lasso GMM model for a sequence of <code>lambda</code> values using the <code>optim()</code> function to minimize the GMM objective function. The resulting solution path shows the parameter estimates as a function of the regularization parameter.</p>
<p><strong>The Lasso GMM approach offers several benefits:</strong></p>
<ol type="1">
<li><p>Variable selection: Lasso regularization automatically selects relevant moment conditions by shrinking some parameter estimates to exactly zero. This can help identify the most informative moments and improve the interpretability of the model.</p></li>
<li><p>Bias-variance trade-off: By constraining the magnitude of the parameter estimates, Lasso regularization can reduce the variance of the estimates at the cost of introducing some bias. This bias-variance trade-off can lead to improved out-of-sample performance and better generalization.</p></li>
<li><p>Handling high-dimensional data: Lasso GMM can handle situations where the number of moment conditions is large relative to the sample size. It can effectively select a subset of relevant moments and provide stable estimates even in high-dimensional settings.</p></li>
</ol>
<p>Another machine learning technique that has been applied to GMM estimation is the use of neural networks. Neural networks can be used to learn complex relationships between the variables and the moment conditions, allowing for more flexible and data-driven specifications of the moment functions.</p>
<p>R Code Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load necessary packages</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"keras"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for neural network GMM</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> data)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the neural network architecture</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">32</span>, <span class="at">activation =</span> <span class="st">"relu"</span>, <span class="at">input_shape =</span> <span class="fu">ncol</span>(X)) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">compile</span>(</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">optimizer =</span> <span class="st">"adam"</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">loss =</span> <span class="st">"mse"</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the neural network</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X, <span class="at">y =</span> y,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">100</span>, <span class="at">batch_size =</span> <span class="dv">32</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the learned moment functions</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>moment_functions <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> data)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(X)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(moments)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform GMM estimation with the learned moment functions</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>gmm_model <span class="ot">&lt;-</span> <span class="fu">gmm</span>(moment_functions, <span class="at">data =</span> data, <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we use the <code>keras</code> package to define and train a neural network for learning the moment functions. The neural network takes the covariates as input and learns to predict the values of the moment conditions.</p>
<p>After training the neural network, we extract the learned moment functions and use them in the GMM estimation. The <code>gmm()</code> function from the <code>gmm</code> package is used to estimate the model with the learned moment functions.</p>
<p>The neural network approach to GMM estimation offers the following advantages:</p>
<ol type="1">
<li><p>Flexibility in moment specification: Neural networks can learn complex and nonlinear relationships between the variables and the moment conditions. This allows for more flexible and data-driven specifications of the moment functions, potentially capturing important patterns in the data.</p></li>
<li><p>Automatic feature extraction: Neural networks can automatically learn relevant features from the input data, reducing the need for manual feature engineering. This can be particularly useful when dealing with high-dimensional or unstructured data.</p></li>
<li><p>Adaptability to different data types: Neural networks can handle various types of data, including continuous, categorical, and textual data. This flexibility makes them applicable to a wide range of multilevel modeling problems.</p></li>
</ol>
<p>However, the use of neural networks in GMM estimation also has some limitations:</p>
<ol type="1">
<li><p>Interpretability: Neural networks are often considered “black boxes” due to their complex and nonlinear structure. The learned moment functions may not have a clear economic or theoretical interpretation, making it difficult to assess the validity of the model assumptions.</p></li>
<li><p>Computational complexity: Training neural networks can be computationally intensive, especially for large datasets or complex network architectures. The computational burden may increase with the size of the data and the number of layers in the network.</p></li>
<li><p>Overfitting: Neural networks are prone to overfitting, particularly when the sample size is small relative to the number of parameters in the network. Regularization techniques, such as dropout or L2 regularization, can help mitigate overfitting but require careful tuning.</p></li>
</ol>
<p>Despite these limitations, the integration of machine learning techniques with GMM estimation in multilevel models offers exciting opportunities for improving the efficiency, flexibility, and robustness of the estimates. By leveraging the power of data-driven algorithms, researchers can uncover complex patterns, select relevant moment conditions, and obtain more reliable inferences in the presence of high-dimensional or unstructured data.</p>
<p>As the field of machine learning continues to evolve, we can expect further advancements in the application of these techniques to GMM estimation in multilevel models. Researchers should stay informed about the latest developments and carefully consider the trade-offs and limitations when incorporating machine learning methods into their GMM estimation framework.</p>
</section>
<section id="empirical-application-and-case-studies" class="level4" data-number="8.1.9.6">
<h4 data-number="8.1.9.6" class="anchored" data-anchor-id="empirical-application-and-case-studies"><span class="header-section-number">8.1.9.6</span> Empirical Application and Case Studies</h4>
<p>To illustrate the practical application of GMM in multilevel modeling for financial data analytics, we present two case studies that demonstrate the estimation process and interpretation of results.</p>
<p>Case Study 1: Estimating the Impact of Firm Characteristics on Stock Returns</p>
<p>Objective: - Investigate the relationship between firm characteristics (e.g., size, book-to-market ratio) and stock returns using a multilevel GMM approach.</p>
<p>Data: - Panel data on stock returns and firm characteristics for a sample of publicly traded companies over multiple years.</p>
<p>Model Specification: - Specify a multilevel model with stock returns as the dependent variable and firm characteristics as the explanatory variables. - Include firm-level random effects to capture unobserved heterogeneity across firms. - Use lagged firm characteristics as instruments to address potential endogeneity.</p>
<p>R Code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"stock_returns_data.csv"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the moment conditions</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>moment_conditions <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, data) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> data<span class="sc">$</span>return <span class="sc">-</span> beta[<span class="dv">1</span>] <span class="sc">-</span> beta[<span class="dv">2</span>] <span class="sc">*</span> data<span class="sc">$</span>size <span class="sc">-</span> beta[<span class="dv">3</span>] <span class="sc">*</span> data<span class="sc">$</span>book_to_market</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  instruments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, data<span class="sc">$</span>lagged_size, data<span class="sc">$</span>lagged_book_to_market)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> instruments <span class="sc">*</span> residuals</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">colMeans</span>(moments))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform GMM estimation</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>gmm_model <span class="ot">&lt;-</span> <span class="fu">gmm</span>(moment_conditions, <span class="at">data =</span> data, <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_model)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform model diagnostics</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>J_test <span class="ot">&lt;-</span> gmm<span class="sc">::</span><span class="fu">specTest</span>(gmm_model)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(J_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interpretation: - The GMM estimates provide insights into the impact of firm size and book-to-market ratio on stock returns, while accounting for unobserved firm-level heterogeneity. - The J-test assesses the validity of the moment conditions and helps determine the appropriateness of the model specification.</p>
<p>Case Study 2: Analyzing the Determinants of Corporate Bond Yields</p>
<p>Objective: - Examine the factors influencing corporate bond yields using a multilevel GMM framework.</p>
<p>Data: - Panel data on corporate bond yields and bond characteristics (e.g., credit rating, maturity) for a sample of corporate bonds across different industries and time periods.</p>
<p>Model Specification: - Specify a multilevel model with corporate bond yields as the dependent variable and bond characteristics as the explanatory variables. - Include industry-level random effects to capture unobserved heterogeneity across industries. - Use macroeconomic variables (e.g., interest rates, GDP growth) as instruments to address potential endogeneity.</p>
<p>R Code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"corporate_bond_data.csv"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the moment conditions</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>moment_conditions <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, data) {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> data<span class="sc">$</span>yield <span class="sc">-</span> beta[<span class="dv">1</span>] <span class="sc">-</span> beta[<span class="dv">2</span>] <span class="sc">*</span> data<span class="sc">$</span>credit_rating <span class="sc">-</span> beta[<span class="dv">3</span>] <span class="sc">*</span> data<span class="sc">$</span>maturity</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  instruments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, data<span class="sc">$</span>interest_rate, data<span class="sc">$</span>gdp_growth)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  moments <span class="ot">&lt;-</span> instruments <span class="sc">*</span> residuals</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">colMeans</span>(moments))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform GMM estimation with clustered standard errors</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>gmm_model <span class="ot">&lt;-</span> <span class="fu">gmm</span>(moment_conditions, <span class="at">data =</span> data, <span class="at">x0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov =</span> <span class="st">"clustered"</span>, <span class="at">cluster =</span> data<span class="sc">$</span>industry)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_model, <span class="at">robust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform model diagnostics</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>J_test <span class="ot">&lt;-</span> gmm<span class="sc">::</span><span class="fu">specTest</span>(gmm_model)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(J_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interpretation: - The GMM estimates shed light on the impact of credit rating and maturity on corporate bond yields, while accounting for industry-level heterogeneity. - The use of clustered standard errors ensures robust inference by accounting for potential correlation within industries. - The J-test provides evidence on the validity of the moment conditions and the appropriateness of the model specification.</p>
<p>These case studies demonstrate the application of GMM in multilevel modeling for financial data analytics. The specific modeling choices, such as the selection of instruments and the inclusion of random effects, depend on the research question and the available data.</p>
<p>When presenting the results, it is essential to provide a clear interpretation of the estimates, discuss the economic significance of the findings, and assess the robustness of the results through sensitivity analyses and model diagnostics.</p>
<p>Furthermore, it is important to acknowledge the limitations of the analysis, such as the potential for omitted variable bias, measurement errors, or the sensitivity of the results to the choice of instruments or moment conditions.</p>
<p>By providing detailed case studies and discussing the interpretation and limitations of the analysis, researchers can effectively communicate the insights gained from GMM estimation in multilevel models and contribute to the advancement of financial data analytics.</p>
<section id="references" class="level5" data-number="8.1.9.6.1">
<h5 data-number="8.1.9.6.1" class="anchored" data-anchor-id="references"><span class="header-section-number">8.1.9.6.1</span> References</h5>
<ul>
<li>Case Study 1: Estimating the Impact of Firm Characteristics on Stock Returns</li>
</ul>
<ol type="1">
<li>Fama, E. F., &amp; French, K. R. (1993). Common risk factors in the returns on stocks and bonds. Journal of Financial Economics, 33(1), 3-56.
<ul>
<li>This seminal paper introduces the Fama-French three-factor model, which includes firm size and book-to-market ratio as important determinants of stock returns.</li>
</ul></li>
<li>Hou, K., Xue, C., &amp; Zhang, L. (2015). Digesting anomalies: An investment approach. The Review of Financial Studies, 28(3), 650-705.
<ul>
<li>This study employs a GMM approach to investigate the relationship between firm characteristics and stock returns, addressing potential endogeneity issues.</li>
</ul></li>
<li>Lewellen, J., Nagel, S., &amp; Shanken, J. (2010). A skeptical appraisal of asset pricing tests. Journal of Financial Economics, 96(2), 175-194.
<ul>
<li>This paper discusses the importance of using appropriate instruments and accounting for unobserved heterogeneity in asset pricing tests, which is relevant for the multilevel GMM approach.</li>
</ul></li>
</ol>
<ul>
<li>Case Study 2: Analyzing the Determinants of Corporate Bond Yields</li>
</ul>
<ol type="1">
<li>Collin-Dufresne, P., Goldstein, R. S., &amp; Martin, J. S. (2001). The determinants of credit spread changes. The Journal of Finance, 56(6), 2177-2207.
<ul>
<li>This study examines the factors influencing credit spreads on corporate bonds, considering bond characteristics and macroeconomic variables.</li>
</ul></li>
<li>Campbell, J. Y., &amp; Taksler, G. B. (2003). Equity volatility and corporate bond yields. The Journal of Finance, 58(6), 2321-2350.
<ul>
<li>This paper investigates the relationship between equity volatility and corporate bond yields, highlighting the importance of accounting for endogeneity and unobserved heterogeneity.</li>
</ul></li>
<li>Bai, J., Bali, T. G., &amp; Wen, Q. (2019). Common risk factors in the cross-section of corporate bond returns. Journal of Financial Economics, 131(3), 619-642.
<ul>
<li>This study employs a GMM approach to identify common risk factors in corporate bond returns, addressing potential endogeneity and cross-sectional dependence.</li>
</ul></li>
</ol>
<ul>
<li>General References on GMM and Multilevel Modeling:</li>
</ul>
<ol type="1">
<li>Roodman, D. (2009). How to do xtabond2: An introduction to difference and system GMM in Stata. The Stata Journal, 9(1), 86-136.
<ul>
<li>This paper provides a comprehensive guide to implementing GMM estimators in a multilevel context using Stata, which can be adapted to R.</li>
</ul></li>
<li>Arellano, M., &amp; Bover, O. (1995). Another look at the instrumental variable estimation of error-components models. Journal of Econometrics, 68(1), 29-51.
<ul>
<li>This study introduces the system GMM estimator, which is commonly used in multilevel modeling to address endogeneity and unobserved heterogeneity.</li>
</ul></li>
<li>Hox, J. J., Moerbeek, M., &amp; van de Schoot, R. (2018). Multilevel analysis: Techniques and applications (3rd ed.). Routledge.
<ul>
<li>This book provides a comprehensive treatment of multilevel modeling techniques, including discussions on GMM estimation and its applications.</li>
</ul></li>
</ol>
</section>
</section>
<section id="conclusion-and-future-directions" class="level4" data-number="8.1.9.7">
<h4 data-number="8.1.9.7" class="anchored" data-anchor-id="conclusion-and-future-directions"><span class="header-section-number">8.1.9.7</span> Conclusion and Future Directions</h4>
<p>In this exposition, we have explored the application of the Generalized Method of Moments (GMM) in multilevel modeling for financial data analytics. We have discussed the theoretical foundations of GMM, its advantages in handling endogeneity and moment conditions, and its relevance in the context of hierarchical financial data.</p>
<p>Through practical examples and case studies, we have demonstrated the implementation of GMM in R, showcasing its flexibility in incorporating different moment conditions, addressing unobserved heterogeneity, and obtaining robust inferences. We have also highlighted the importance of model specification, moment selection, and diagnostic tests to ensure the validity and reliability of the GMM estimates.</p>
<p>Furthermore, we have explored the Bayesian perspective on GMM estimation, which combines the strengths of GMM with the benefits of Bayesian inference. The Bayesian framework allows for the incorporation of prior information, provides a more comprehensive characterization of uncertainty, and offers flexibility in modeling complex hierarchical structures.</p>
<p>Additionally, we have discussed the recent advances in machine learning that have been applied to GMM estimation in multilevel models. Techniques such as regularization and neural networks have shown promise in handling high-dimensional data, selecting relevant moment conditions, and capturing complex relationships between variables.</p>
<p>Despite the significant progress made in the application of GMM in multilevel modeling for financial data analytics, there are still several challenges and opportunities for future research:</p>
<ol type="1">
<li><p>Improving the estimation of the optimal weighting matrix: The efficiency and finite sample properties of GMM estimates depend crucially on the choice of the weighting matrix. Further research is needed to develop robust and data-driven methods for estimating the optimal weighting matrix, particularly in the presence of many moment conditions or small sample sizes.</p></li>
<li><p>Incorporating machine learning techniques: While regularization and neural networks have been explored in the context of GMM estimation, there is still much room for further integration of machine learning techniques. Researchers can investigate the use of other advanced methods, such as deep learning or ensemble learning, to enhance the flexibility and predictive power of GMM models.</p></li>
<li><p>Extending GMM to more complex data structures: Financial data often exhibits complex dependencies, such as spatial or network effects, which may not be fully captured by the current multilevel modeling framework. Future research can explore the extension of GMM to handle more intricate data structures, such as spatial-temporal models or network-based models.</p></li>
<li><p>Developing user-friendly software and tools: To facilitate the widespread adoption of GMM in multilevel modeling for financial data analytics, there is a need for the development of user-friendly software packages and tools. These tools should provide intuitive interfaces, efficient implementations, and comprehensive documentation to support researchers and practitioners in applying GMM to their financial research.</p></li>
<li><p>Conducting extensive simulation studies and empirical comparisons: To assess the performance and robustness of GMM estimators in various settings, it is crucial to conduct extensive simulation studies and empirical comparisons. These studies can help identify the strengths and limitations of different GMM specifications, moment conditions, and estimation techniques under different data generating processes and sample sizes.</p></li>
<li><p>Exploring the intersection of GMM and other advanced statistical methods: There are opportunities to investigate the intersection of GMM with other advanced statistical methods, such as copula models, quantile regression, or functional data analysis. Combining the strengths of these methods with GMM can potentially lead to more comprehensive and flexible modeling approaches for financial data analytics.</p></li>
</ol>
<p>In conclusion, the application of GMM in multilevel modeling for financial data analytics has shown great promise in addressing the challenges posed by hierarchical and complex financial data. By leveraging the power of GMM, researchers can obtain more reliable and robust inferences, account for unobserved heterogeneity, and incorporate prior information and machine learning techniques.</p>
<p>As the field of financial data analytics continues to evolve, it is essential for researchers to stay informed about the latest developments in GMM estimation and related areas. By actively engaging in methodological advancements, empirical applications, and cross-disciplinary collaborations, we can further enhance the toolkit available for analyzing financial data and contribute to the development of more accurate and insightful models for decision-making in finance.</p>
</section>
</section>
<section id="excercise" class="level3" data-number="8.1.10">
<h3 data-number="8.1.10" class="anchored" data-anchor-id="excercise"><span class="header-section-number">8.1.10</span> Excercise</h3>
<p>Let’s generate simulated data representing annual sales growth rates for subsidiaries belonging to different parent companies operating in various sectors. Our goal is to compare the performance of fixed effect models (FEM), random effect models (REM), and hierarchical linear models (HLM) in estimating sector-specific intercepts while controlling for parent company effects.</p>
<p>First, load necessary libraries and set seed for reproducibility:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4) <span class="co"># For REM &amp; HLM</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plm)   <span class="co"># For FEM</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, generate synthetic data consisting of sales growth rate <code>y</code>, parent company identifier <code>parent_id</code>, and sector classification <code>sector</code>. Assume there are 100 parents and five sectors, and each parent owns four subsidiaries observed annually over six years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of parents, number of subsidiaries per parent, number of years, and number of sectors</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n_parents <span class="ot">&lt;-</span> <span class="dv">100</span>  </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>subsidiary_per_parent <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>sectors <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate IDs</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>parent_id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_parents, <span class="at">each=</span>subsidiary_per_parent<span class="sc">*</span>years)  </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate time variable </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2015</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">times=</span>n_parents<span class="sc">*</span>subsidiary_per_parent)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sectors</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>sector <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>sectors, <span class="at">each=</span>subsidiary_per_parent<span class="sc">*</span>years<span class="sc">/</span>sectors))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># True sector effects  </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(sectors, <span class="dv">0</span>, <span class="dv">1</span>)  </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Parent effects</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_parents, <span class="dv">0</span>, <span class="dv">1</span>) </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate growth rates   </span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> alpha[parent_id] <span class="sc">+</span> beta[sector] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(parent_id), <span class="at">sd=</span>sigma)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataset</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y, parent_id, sector, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now fit the three models using respective packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit fixed effect model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsidiary id</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sub_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n_parents<span class="sc">*</span>subsidiary_per_parent<span class="sc">*</span>years</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>sub_id <span class="ot">&lt;-</span> sub_id</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"parent_id"</span>, <span class="st">"sub_id"</span>, <span class="st">"year"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>fe_model <span class="ot">&lt;-</span> <span class="fu">plm</span>(y <span class="sc">~</span> <span class="fu">factor</span>(sector), data, <span class="at">index =</span> index)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit random effect model</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>re_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> <span class="fu">factor</span>(sector) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> parent_id), data)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit hierarchical linear model</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>hlm_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> <span class="fu">factor</span>(sector) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>parent_id<span class="sc">/</span>sector), data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare the estimated coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Fixed Effect Estimates:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">coef</span>(fe_model)[<span class="sc">-</span><span class="dv">1</span>], <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">Random Effect Estimates:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">fixef</span>(re_model), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">Hierarchical Linear Model Estimates:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ranef</span>(hlm_model)<span class="sc">$</span>parent_id[[<span class="dv">1</span>]], <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ranef</span>(hlm_model)<span class="sc">$</span>parent_id<span class="sc">$</span>sector, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should observe that although all three models produce comparable estimates, the standard errors vary due to their differing assumptions about the nature of unobserved heterogeneity. Perform additional diagnostic checks and choose the best fitting model according to your problem requirements.</p>
<p>Keep in mind that this example represents a simplified scenario with only one explanatory variable. Real-world situations typically involve multiple predictors and require rigorous preprocessing steps, hypothesis testing, and validation procedures. Nevertheless, this exercise serves as a starting point towards grasping fundamental distinctions amongst FEM, REM, and HLM.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ml.html" class="pagination-link" aria-label="Machine Learning in Finance">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Machine Learning in Finance</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./causal.html" class="pagination-link" aria-label="Causal inference">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Causal inference</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>